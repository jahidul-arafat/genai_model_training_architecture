<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS GenAI LLM Training Architecture - Multi-Deployment Templates</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            overflow: hidden;
            position: relative;
        }

        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .header {
            padding: 15px 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .title {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff9500, #ff6b35, #00d4aa, #0080ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            color: #a0a0a0;
        }

        .aws-badge {
            display: inline-block;
            background: linear-gradient(45deg, #ff9500, #ff6b35);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .deployment-selector {
            position: absolute;
            top: 15px;
            left: 20px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 165, 0, 0.3);
            z-index: 200;
        }

        .deployment-selector h4 {
            color: #ff9500;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .deployment-selector select {
            width: 250px;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid rgba(255, 165, 0, 0.3);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 0.85rem;
        }

        .template-info {
            margin-top: 10px;
            font-size: 0.75rem;
            color: #a0a0a0;
            line-height: 1.3;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            cursor: grab;
        }

        .canvas-container.dragging {
            cursor: grabbing;
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls {
            position: absolute;
            top: 100px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 165, 0, 0.3);
            z-index: 100;
            max-height: 75vh;
            overflow-y: auto;
            min-width: 320px;
        }

        .control-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-section:last-child {
            border-bottom: none;
        }

        .control-section h4 {
            color: #ff9500;
            margin-bottom: 12px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
        }

        .control-section h4::before {
            content: '‚ñ∂';
            margin-right: 8px;
            font-size: 0.8rem;
        }

        .control-group {
            margin-bottom: 12px;
        }

        .control-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85rem;
            color: #e0e0e0;
            font-weight: 500;
        }

        .control-group button {
            background: linear-gradient(45deg, #ff9500, #ff6b35);
            border: none;
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 2px;
            font-size: 0.8rem;
        }

        .control-group button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 149, 0, 0.4);
        }

        .control-group button.secondary {
            background: linear-gradient(45deg, #0080ff, #00d4aa);
        }

        .control-group button.danger {
            background: linear-gradient(45deg, #ff4757, #ff3838);
        }

        .control-group input[type="range"] {
            width: 100%;
            margin: 5px 0;
            accent-color: #ff9500;
        }

        .control-group select {
            width: 100%;
            padding: 6px;
            border-radius: 4px;
            border: 1px solid rgba(255, 165, 0, 0.3);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 0.85rem;
        }

        .metrics-panel {
            position: absolute;
            top: 200px;
            left: 20px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 170, 0.3);
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            min-width: 280px;
            max-height: 65vh;
            overflow-y: auto;
        }

        .metrics-panel h3 {
            margin-bottom: 15px;
            color: #00d4aa;
            font-family: 'Segoe UI', sans-serif;
            font-size: 1rem;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .metric-label {
            color: #b0b0b0;
        }

        .metric-value {
            color: #00ff88;
            font-weight: bold;
        }

        .metric-critical {
            color: #ff4757;
        }

        .metric-warning {
            color: #ffa502;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 350px;
        }

        .legend h3 {
            margin-bottom: 15px;
            color: #ff9500;
            font-size: 1rem;
        }

        .legend-section {
            margin-bottom: 15px;
        }

        .legend-section h4 {
            color: #00d4aa;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.8rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(15px);
            color: white;
            padding: 15px 18px;
            border-radius: 10px;
            border: 1px solid rgba(255, 165, 0, 0.4);
            font-size: 0.8rem;
            z-index: 1000;
            pointer-events: none;
            max-width: 320px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.6);
        }

        .tooltip h4 {
            color: #ff9500;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .tooltip-section {
            margin-bottom: 10px;
        }

        .tooltip-section:last-child {
            margin-bottom: 0;
        }

        .tooltip-label {
            color: #a0a0a0;
            font-size: 0.75rem;
            margin-bottom: 3px;
            font-weight: 500;
        }

        .aws-service-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin: 2px;
            font-weight: bold;
        }

        .service-ec2 { background: #ff9500; color: white; }
        .service-sagemaker { background: #00d4aa; color: white; }
        .service-s3 { background: #ff6b35; color: white; }
        .service-bedrock { background: #9966cc; color: white; }
        .service-lambda { background: #ffa502; color: white; }
        .service-ecs { background: #0080ff; color: white; }
        .service-eks { background: #326ce5; color: white; }
        .service-batch { background: #ff6b6b; color: white; }
        .service-fargate { background: #ff8a65; color: white; }
        .service-emr { background: #4caf50; color: white; }
        .service-parallelcluster { background: #9c27b0; color: white; }

        .training-progress {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 165, 0, 0.3);
            display: none;
        }

        .progress-bar {
            width: 200px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9500, #00d4aa);
            width: 0%;
            transition: width 0.3s ease;
        }

        .floating-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 149, 0, 0.3);
            border-radius: 50%;
            animation: float 12s infinite linear;
        }

        @keyframes float {
            from {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            to {
                transform: translateY(-100px) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        .dragging-indicator {
            position: absolute;
            pointer-events: none;
            color: #ff9500;
            font-size: 0.8rem;
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 10px;
            border-radius: 5px;
            z-index: 999;
            border: 1px solid rgba(255, 149, 0, 0.5);
        }

        .deployment-badge {
            position: absolute;
            top: 10px;
            right: 20px;
            background: linear-gradient(45deg, #00d4aa, #0080ff);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 150;
        }

        .architecture-details {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 165, 0, 0.3);
            max-width: 400px;
            max-height: 60vh;
            overflow-y: auto;
            z-index: 150;
        }

        .architecture-details h3 {
            color: #ff9500;
            margin-bottom: 15px;
            font-size: 1rem;
            display: flex;
            align-items: center;
        }

        .architecture-details h3::before {
            content: 'üèóÔ∏è';
            margin-right: 8px;
        }

        .arch-section {
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .arch-section:last-child {
            border-bottom: none;
        }

        .arch-section h4 {
            color: #00d4aa;
            font-size: 0.85rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .arch-section h4::before {
            content: '‚ñ∏';
            margin-right: 6px;
            color: #ff9500;
        }

        .component-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .component-list li {
            font-size: 0.75rem;
            color: #e0e0e0;
            margin-bottom: 4px;
            padding-left: 12px;
            position: relative;
            line-height: 1.4;
        }

        .component-list li::before {
            content: '‚Ä¢';
            color: #ff9500;
            position: absolute;
            left: 0;
        }

        .workflow-step {
            background: rgba(255, 149, 0, 0.1);
            border-left: 3px solid #ff9500;
            padding: 8px 12px;
            margin: 8px 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.75rem;
            line-height: 1.3;
        }

        .benefits-list {
            background: rgba(0, 212, 170, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin: 8px 0;
        }

        .benefits-list h5 {
            color: #00d4aa;
            font-size: 0.8rem;
            margin: 0 0 6px 0;
        }

        .benefits-list ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .benefits-list li {
            font-size: 0.7rem;
            color: #b0b0b0;
            margin-bottom: 3px;
            padding-left: 10px;
            position: relative;
        }

        .benefits-list li::before {
            content: '‚úì';
            color: #00d4aa;
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .cost-estimate {
            background: rgba(255, 107, 53, 0.1);
            border-radius: 8px;
            padding: 8px 12px;
            margin: 8px 0;
            text-align: center;
        }

        .cost-estimate .cost-label {
            font-size: 0.7rem;
            color: #a0a0a0;
            margin-bottom: 3px;
        }

        .cost-estimate .cost-value {
            font-size: 0.85rem;
            color: #ff6b35;
            font-weight: bold;
        }

        .live-console {
            position: absolute;
            top: 100px;
            left: 20px;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 136, 0.3);
            width: 380px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 180;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
        }

        .console-header {
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .console-controls {
            display: flex;
            gap: 5px;
        }

        .console-btn {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .console-btn:hover {
            background: rgba(0, 255, 136, 0.4);
        }

        .console-logs {
            max-height: 220px;
            overflow-y: auto;
            border-top: 1px solid rgba(0, 255, 136, 0.2);
            padding-top: 8px;
        }

        .log-entry {
            margin-bottom: 3px;
            padding: 2px 0;
            line-height: 1.3;
            word-wrap: break-word;
        }

        .log-timestamp {
            color: #888;
            margin-right: 8px;
        }

        .log-info { color: #00d4aa; }
        .log-warning { color: #ffa502; }
        .log-error { color: #ff4757; }
        .log-success { color: #00ff88; }
        .log-data { color: #0080ff; }
        .log-system { color: #9966cc; }

        .cost-tracker {
            position: absolute;
            top: 420px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 107, 53, 0.3);
            width: 280px;
            z-index: 180;
            font-family: 'Courier New', monospace;
        }

        .cost-header {
            color: #ff6b35;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .cost-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.75rem;
        }

        .cost-label {
            color: #b0b0b0;
        }

        .cost-value {
            color: #ff6b35;
            font-weight: bold;
        }

        .cost-total {
            border-top: 1px solid rgba(255, 107, 53, 0.3);
            padding-top: 8px;
            margin-top: 8px;
            font-weight: bold;
        }

        .cost-savings {
            color: #00ff88;
        }

        .draggable-panel {
            cursor: move;
            user-select: none;
            transition: box-shadow 0.2s ease;
        }

        .draggable-panel:hover {
            box-shadow: 0 8px 32px rgba(255, 149, 0, 0.3);
        }

        .draggable-panel.dragging {
            z-index: 9999;
            transform: rotate(2deg);
            box-shadow: 0 12px 40px rgba(255, 149, 0, 0.5);
        }

        .draggable-panel .drag-handle {
            cursor: move;
            padding: 5px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
        }

        .draggable-panel .drag-handle::before {
            content: '‚ãÆ‚ãÆ';
            color: #ff9500;
            margin-right: 8px;
            font-weight: bold;
            letter-spacing: 2px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1 class="title">üöÄ AWS GenAI LLM Training Architecture</h1>
        <span class="aws-badge">AWS CLOUD</span>
        <p class="subtitle">Multi-Template ML training pipeline with enterprise deployment patterns</p>
        <div class="deployment-badge" id="deploymentBadge">Standard Template</div>
    </div>

    <div class="deployment-selector">
        <h4>üèóÔ∏è Deployment Template</h4>
        <select id="deploymentTemplate" onchange="changeDeploymentTemplate()">
            <option value="standard">Standard Training Pipeline</option>
            <option value="eks-kubernetes">EKS Kubernetes Cluster</option>
            <option value="batch-hpc">AWS Batch HPC Training</option>
            <option value="emr-spark">EMR Spark Distributed</option>
            <option value="fargate-serverless">Fargate Serverless</option>
            <option value="parallelcluster">AWS ParallelCluster</option>
            <option value="hybrid-multicloud">Hybrid Multi-Cloud</option>
            <option value="edge-federated">Edge Federated Learning</option>
        </select>
        <div class="template-info" id="templateInfo">
            Comprehensive LLM training with SageMaker, EC2, and managed services
        </div>
    </div>

    <div class="canvas-container" id="canvasContainer">
        <canvas id="canvas"></canvas>
        <div class="floating-particles" id="particles"></div>
        <div id="tooltip" class="tooltip" style="display: none;"></div>
        <div id="draggingIndicator" class="dragging-indicator" style="display: none;"></div>

        <div class="training-progress" id="trainingProgress">
            <div style="font-size: 0.8rem; color: #ff9500;">Training Progress: <span id="progressText">0%</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="controls">
            <div class="control-section">
                <h4>Training Operations</h4>
                <div class="control-group">
                    <button onclick="startTraining()">üéØ Start Training</button>
                    <button onclick="pauseTraining()" class="secondary">‚è∏Ô∏è Pause Training</button>
                    <button onclick="stopTraining()" class="danger">‚èπÔ∏è Stop Training</button>
                </div>
                <div class="control-group">
                    <button onclick="triggerCheckpoint()">üíæ Checkpoint</button>
                    <button onclick="validateModel()" class="secondary">‚úÖ Validate Model</button>
                </div>
            </div>

            <div class="control-section">
                <h4>Data Pipeline</h4>
                <div class="control-group">
                    <button onclick="triggerDataIngestion()">üì• Ingest Data</button>
                    <button onclick="triggerPreprocessing()">üîÑ Preprocess</button>
                    <button onclick="triggerDataValidation()" class="secondary">‚úì Validate Data</button>
                </div>
            </div>

            <div class="control-section">
                <h4>Compute Management</h4>
                <div class="control-group">
                    <label>Instance Type:</label>
                    <select id="instanceType" onchange="updateInstanceType()">
                        <option value="p4d.24xlarge">p4d.24xlarge (8x A100)</option>
                        <option value="p3dn.24xlarge">p3dn.24xlarge (8x V100)</option>
                        <option value="trn1.32xlarge">trn1.32xlarge (Trainium)</option>
                        <option value="inf2.48xlarge">inf2.48xlarge (Inferentia)</option>
                    </select>
                </div>
                <div class="control-group">
                    <button onclick="scaleOut()">üìà Scale Out</button>
                    <button onclick="scaleIn()" class="secondary">üìâ Scale In</button>
                    <button onclick="addSpotInstance()">üí∞ Add Spot</button>
                </div>
            </div>

            <div class="control-section">
                <h4>Reliability & Monitoring</h4>
                <div class="control-group">
                    <button onclick="simulateFailure()" class="danger">‚ö†Ô∏è Simulate Failure</button>
                    <button onclick="triggerFailover()" class="secondary">üîÑ Failover</button>
                    <button onclick="runHealthCheck()">‚ù§Ô∏è Health Check</button>
                </div>
            </div>

            <div class="control-section">
                <h4>System Controls</h4>
                <div class="control-group">
                    <label>Animation Speed: <span id="speedValue">1.0x</span></label>
                    <input type="range" id="speedControl" min="0.1" max="3" step="0.1" value="1"
                           onchange="updateSpeed(this.value)">
                </div>
                <div class="control-group">
                    <button onclick="clearCommunications()" class="secondary">üßπ Clear Signals</button>
                    <button onclick="togglePause()">‚è∏Ô∏è Pause</button>
                    <button onclick="resetArchitecture()" class="danger">üîÑ Reset</button>
                </div>
            </div>

            <div class="control-section">
                <h4>Panel Management</h4>
                <div class="control-group">
                    <button onclick="resetAllPanels()" class="secondary">üîÑ Reset Panels</button>
                    <button onclick="minimizeAllPanels()" class="secondary">üîΩ Minimize All</button>
                    <button onclick="showAllPanels()" class="secondary">üëÅÔ∏è Show All</button>
                </div>
                <div class="control-group">
                    <button onclick="togglePanelLock()" class="secondary" id="panelLockBtn">üîí Lock Panels</button>
                    <button onclick="saveLayout()" class="secondary">üíæ Save Layout</button>
                    <button onclick="loadLayout()" class="secondary">üìÅ Load Layout</button>
                </div>
                <div class="control-group">
                    <button onclick="showKeyboardShortcuts()" class="secondary">‚å®Ô∏è Shortcuts</button>
                </div>
            </div>
        </div>

        <div class="metrics-panel" id="metricsPanel">
            <h3>üîç System Metrics</h3>
            <div class="metric-row">
                <span class="metric-label">Training Instances:</span>
                <span class="metric-value" id="trainingInstances">4</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">GPU Utilization:</span>
                <span class="metric-value" id="gpuUtilization">78%</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Model Parameters:</span>
                <span class="metric-value" id="modelParams">70B</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Training Loss:</span>
                <span class="metric-value" id="trainingLoss">2.34</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Throughput:</span>
                <span class="metric-value" id="throughput">1.2k tokens/sec</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Data Processed:</span>
                <span class="metric-value" id="dataProcessed">2.3TB</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Network I/O:</span>
                <span class="metric-value" id="networkIO">450 MB/s</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Reliability Score:</span>
                <span class="metric-value" id="reliabilityScore">99.2%</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Cost/Hour:</span>
                <span class="metric-value" id="costPerHour">$892</span>
            </div>
        </div>

        <!-- ADD THIS NEW DIV -->
        <div class="architecture-details" id="architectureDetails">
            <h3>Architecture Overview</h3>
            <div id="architectureContent">
                <!-- Dynamic architecture details based on template -->
            </div>
        </div>

        <!-- YOUR EXISTING .legend DIV (keep as is) -->
        <div class="legend">
            <h3>üèóÔ∏è Architecture Components</h3>
            <div id="legendContent">
                <!-- Dynamic legend content based on template -->
            </div>
        </div>


        <!-- Live Console -->
        <div class="live-console" id="liveConsole">
            <div class="console-header">
                <span>üñ•Ô∏è Live System Console</span>
                <div class="console-controls">
                    <button class="console-btn" onclick="clearConsole()">Clear</button>
                    <button class="console-btn" onclick="toggleConsole()">Hide</button>
                </div>
            </div>
            <div class="console-logs" id="consoleLogs">
                <div class="log-entry log-system">
                    <span class="log-timestamp">[INIT]</span>
                    <span>AWS GenAI Architecture Console initialized</span>
                </div>
            </div>
        </div>

        <!-- Cost Tracker -->
        <div class="cost-tracker" id="costTracker">
            <div class="cost-header">üí∞ Real-time Cost Tracker</div>
            <div id="costBreakdown">
                <!-- Dynamic cost breakdown -->
            </div>
        </div>
    </div>


</div>

<script>
    class AWSGenAIArchitecture {
        // Replace your existing constructor with this fixed version:

        constructor() {
            this.canvas = document.getElementById('canvas');
            this.ctx = this.canvas.getContext('2d');
            this.canvasContainer = document.getElementById('canvasContainer');
            this.tooltip = document.getElementById('tooltip');
            this.draggingIndicator = document.getElementById('draggingIndicator');

            this.services = [];
            this.communications = [];
            this.animationSpeed = 1;
            this.isPaused = false;
            this.isTraining = false;
            this.trainingProgress = 0;
            this.currentTemplate = 'standard';

            // Mouse interaction state
            this.isDragging = false;
            this.draggedService = null;
            this.mousePos = { x: 0, y: 0 };
            this.lastMousePos = { x: 0, y: 0 };

            // Console and cost tracking properties - MOVED BEFORE initializeDeploymentTemplate
            this.consoleVisible = true;
            this.maxConsoleEntries = 50;
            this.scaledInstances = [];  // ‚Üê This was causing the error!
            this.baseCosts = {};

            // AWS-specific metrics
            this.awsMetrics = {
                trainingInstances: 4,
                gpuUtilization: 78,
                modelParams: '70B',
                trainingLoss: 2.34,
                throughput: '1.2k tokens/sec',
                dataProcessed: '2.3TB',
                networkIO: '450 MB/s',
                reliabilityScore: 99.2,
                costPerHour: 892
            };

            // Deployment templates
            this.deploymentTemplates = {
                'standard': {
                    name: 'Standard Training Pipeline',
                    description: 'Comprehensive LLM training with SageMaker, EC2, and managed services',
                    badge: 'Standard Template'
                },
                'eks-kubernetes': {
                    name: 'EKS Kubernetes Cluster',
                    description: 'Container-orchestrated training with Kubernetes on AWS EKS',
                    badge: 'Kubernetes Template'
                },
                'batch-hpc': {
                    name: 'AWS Batch HPC Training',
                    description: 'High-performance computing with AWS Batch for massive parallel training',
                    badge: 'HPC Template'
                },
                'emr-spark': {
                    name: 'EMR Spark Distributed',
                    description: 'Apache Spark on EMR for distributed data processing and training',
                    badge: 'Spark Template'
                },
                'fargate-serverless': {
                    name: 'Fargate Serverless',
                    description: 'Serverless container training with AWS Fargate auto-scaling',
                    badge: 'Serverless Template'
                },
                'parallelcluster': {
                    name: 'AWS ParallelCluster',
                    description: 'HPC cluster with Slurm scheduler for large-scale model training',
                    badge: 'HPC Cluster Template'
                },
                'hybrid-multicloud': {
                    name: 'Hybrid Multi-Cloud',
                    description: 'Multi-cloud deployment with on-premises and AWS hybrid architecture',
                    badge: 'Hybrid Template'
                },
                'edge-federated': {
                    name: 'Edge Federated Learning',
                    description: 'Distributed federated learning across edge devices and AWS regions',
                    badge: 'Federated Template'
                }
            };

            this.setupCanvas();
            this.setupEventListeners();
            this.initializeDeploymentTemplate('standard');  // Now scaledInstances is already initialized
            this.createFloatingParticles();
            this.animate();
            this.startMetricsUpdater();
        }

        setupCanvas() {
            const rect = this.canvas.getBoundingClientRect();
            this.canvas.width = rect.width * 2;
            this.canvas.height = rect.height * 2;
            this.ctx.scale(2, 2);

            window.addEventListener('resize', () => {
                const rect = this.canvas.getBoundingClientRect();
                this.canvas.width = rect.width * 2;
                this.canvas.height = rect.height * 2;
                this.ctx.scale(2, 2);
            });
        }

        setupEventListeners() {
            this.canvas.addEventListener('mousedown', (e) => this.handleMouseDown(e));
            this.canvas.addEventListener('mousemove', (e) => this.handleMouseMove(e));
            this.canvas.addEventListener('mouseup', (e) => this.handleMouseUp(e));
            this.canvas.addEventListener('mouseleave', (e) => this.handleMouseLeave(e));
            this.canvas.addEventListener('contextmenu', (e) => e.preventDefault());
        }

        initializeDeploymentTemplate(templateId) {
            this.currentTemplate = templateId;
            this.services = [];
            this.communications = [];

            const template = this.deploymentTemplates[templateId];
            document.getElementById('deploymentBadge').textContent = template.badge;
            document.getElementById('templateInfo').textContent = template.description;

            switch (templateId) {
                case 'standard':
                    this.initializeStandardTemplate();
                    break;
                case 'eks-kubernetes':
                    this.initializeEKSTemplate();
                    break;
                case 'batch-hpc':
                    this.initializeBatchTemplate();
                    break;
                case 'emr-spark':
                    this.initializeEMRTemplate();
                    break;
                case 'fargate-serverless':
                    this.initializeFargateTemplate();
                    break;
                case 'parallelcluster':
                    this.initializeParallelClusterTemplate();
                    break;
                case 'hybrid-multicloud':
                    this.initializeHybridTemplate();
                    break;
                case 'edge-federated':
                    this.initializeFederatedTemplate();
                    break;
            }

            this.updateLegend();
            this.initializeBaseCosts();
            this.updateCostTracker();
            this.logToConsole(`üèóÔ∏è Template changed to: ${this.deploymentTemplates[templateId].name}`, 'system');
        }

        initializeStandardTemplate() {
            const centerX = this.canvas.width / 4;
            const centerY = this.canvas.height / 4;

            // Central Data Lake (S3)
            this.services.push({
                id: 'S3_DATALAKE',
                name: 'S3 Data Lake',
                x: centerX,
                y: centerY - 200,
                radius: 65,
                baseRadius: 65,
                color: '#ff6b35',
                gradient: ['#ff6b35', '#ff4757'],
                activity: 0,
                pulse: 0,
                awsService: 'S3',
                instanceType: 'Storage',
                vCPUs: 'N/A',
                memory: 'Unlimited',
                utilization: 45,
                throughput: '2.1 GB/s',
                latency: 12,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 86400000,
                slaTarget: 99.9,
                costPerHour: 150,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(8),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.8
            });

            // SageMaker Training Cluster
            this.services.push({
                id: 'SAGEMAKER_TRAINING',
                name: 'SageMaker Training',
                x: centerX - 300,
                y: centerY,
                radius: 75,
                baseRadius: 75,
                color: '#00d4aa',
                gradient: ['#00d4aa', '#0080ff'],
                activity: 0,
                pulse: 0,
                awsService: 'SageMaker',
                instanceType: 'ml.p4d.24xlarge',
                vCPUs: 96,
                memory: 1152,
                utilization: 85,
                throughput: '1.2k tokens/sec',
                latency: 45,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 43200000,
                slaTarget: 99.5,
                costPerHour: 458,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(12),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 99.1
            });

            // EC2 Distributed Training Nodes
            this.services.push({
                id: 'EC2_TRAINING_NODES',
                name: 'EC2 Training Cluster',
                x: centerX + 300,
                y: centerY,
                radius: 70,
                baseRadius: 70,
                color: '#ff9500',
                gradient: ['#ff9500', '#ff6b35'],
                activity: 0,
                pulse: 0,
                awsService: 'EC2',
                instanceType: 'p4d.24xlarge',
                vCPUs: 96,
                memory: 1152,
                utilization: 92,
                throughput: '980 tokens/sec',
                latency: 38,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 21600000,
                slaTarget: 99.0,
                costPerHour: 434,
                isSpot: true,
                availabilityZone: 'us-east-1b',
                organelles: this.createOrganelles(10),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 98.7
            });

            // Bedrock Foundation Models
            this.services.push({
                id: 'BEDROCK_MODELS',
                name: 'Bedrock Foundation',
                x: centerX,
                y: centerY + 250,
                radius: 60,
                baseRadius: 60,
                color: '#9966cc',
                gradient: ['#9966cc', '#6b46c1'],
                activity: 0,
                pulse: 0,
                awsService: 'Bedrock',
                instanceType: 'Managed Service',
                vCPUs: 'Elastic',
                memory: 'Elastic',
                utilization: 35,
                throughput: '500 tokens/sec',
                latency: 120,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 7200000,
                slaTarget: 99.9,
                costPerHour: 125,
                isSpot: false,
                availabilityZone: 'us-east-1c',
                organelles: this.createOrganelles(6),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 99.5
            });

            // Lambda Data Processing
            this.services.push({
                id: 'LAMBDA_PREPROCESSING',
                name: 'Lambda Data Pipeline',
                x: centerX - 150,
                y: centerY - 300,
                radius: 45,
                baseRadius: 45,
                color: '#ffa502',
                gradient: ['#ffa502', '#ff9500'],
                activity: 0,
                pulse: 0,
                awsService: 'Lambda',
                instanceType: '15GB Memory',
                vCPUs: '6 vCPU equiv',
                memory: 15,
                utilization: 65,
                throughput: '2.5k requests/sec',
                latency: 25,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 3600000,
                slaTarget: 99.95,
                costPerHour: 45,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(4),
                membrane: { thickness: 2, opacity: 0.8 },
                reliabilityScore: 99.6
            });

            // ECS Model Serving
            this.services.push({
                id: 'ECS_SERVING',
                name: 'ECS Model Serving',
                x: centerX + 150,
                y: centerY + 150,
                radius: 50,
                baseRadius: 50,
                color: '#0080ff',
                gradient: ['#0080ff', '#00d4aa'],
                activity: 0,
                pulse: 0,
                awsService: 'ECS',
                instanceType: 'c5.4xlarge',
                vCPUs: 16,
                memory: 32,
                utilization: 58,
                throughput: '850 requests/sec',
                latency: 15,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 14400000,
                slaTarget: 99.5,
                costPerHour: 95,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(5),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 99.3
            });

            // CloudWatch Monitoring
            this.services.push({
                id: 'CLOUDWATCH_MONITORING',
                name: 'CloudWatch Monitor',
                x: centerX - 200,
                y: centerY + 200,
                radius: 40,
                baseRadius: 40,
                color: '#ff6b6b',
                gradient: ['#ff6b6b', '#ff8e53'],
                activity: 0,
                pulse: 0,
                awsService: 'CloudWatch',
                instanceType: 'Managed Service',
                vCPUs: 'N/A',
                memory: 'N/A',
                utilization: 25,
                throughput: '10k metrics/sec',
                latency: 8,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.9,
                costPerHour: 25,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(3),
                membrane: { thickness: 2, opacity: 0.8 },
                reliabilityScore: 99.7
            });
        }

        initializeEKSTemplate() {
            const centerX = this.canvas.width / 4;
            const centerY = this.canvas.height / 4;

            // EKS Control Plane
            this.services.push({
                id: 'EKS_CONTROL_PLANE',
                name: 'EKS Control Plane',
                x: centerX,
                y: centerY - 250,
                radius: 70,
                baseRadius: 70,
                color: '#326ce5',
                gradient: ['#326ce5', '#1565c0'],
                activity: 0,
                pulse: 0,
                awsService: 'EKS',
                instanceType: 'Managed Control Plane',
                vCPUs: 'Managed',
                memory: 'Managed',
                utilization: 45,
                throughput: '5k API calls/sec',
                latency: 5,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.95,
                costPerHour: 75,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(8),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.9
            });

            // Worker Node Group 1
            this.services.push({
                id: 'EKS_WORKER_GROUP_1',
                name: 'GPU Worker Nodes',
                x: centerX - 250,
                y: centerY - 50,
                radius: 65,
                baseRadius: 65,
                color: '#ff9500',
                gradient: ['#ff9500', '#ff6b35'],
                activity: 0,
                pulse: 0,
                awsService: 'EKS',
                instanceType: 'p4d.24xlarge',
                vCPUs: 96,
                memory: 1152,
                utilization: 88,
                throughput: '1.5k tokens/sec',
                latency: 35,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 86400000,
                slaTarget: 99.0,
                costPerHour: 520,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(12),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 98.8
            });

            // Worker Node Group 2
            this.services.push({
                id: 'EKS_WORKER_GROUP_2',
                name: 'CPU Worker Nodes',
                x: centerX + 250,
                y: centerY - 50,
                radius: 55,
                baseRadius: 55,
                color: '#00d4aa',
                gradient: ['#00d4aa', '#0080ff'],
                activity: 0,
                pulse: 0,
                awsService: 'EKS',
                instanceType: 'c5n.18xlarge',
                vCPUs: 72,
                memory: 192,
                utilization: 65,
                throughput: '800 tokens/sec',
                latency: 25,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 43200000,
                slaTarget: 99.0,
                costPerHour: 385,
                isSpot: true,
                availabilityZone: 'us-east-1b',
                organelles: this.createOrganelles(10),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 98.5
            });

            // Persistent Storage (EFS)
            this.services.push({
                id: 'EFS_STORAGE',
                name: 'EFS Shared Storage',
                x: centerX - 100,
                y: centerY + 150,
                radius: 50,
                baseRadius: 50,
                color: '#ff6b35',
                gradient: ['#ff6b35', '#ff4757'],
                activity: 0,
                pulse: 0,
                awsService: 'EFS',
                instanceType: 'Managed NFS',
                vCPUs: 'N/A',
                memory: 'Unlimited',
                utilization: 35,
                throughput: '1.5 GB/s',
                latency: 8,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 259200000,
                slaTarget: 99.9,
                costPerHour: 85,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(6),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 99.7
            });

            // Load Balancer
            this.services.push({
                id: 'ALB_LOAD_BALANCER',
                name: 'Application Load Balancer',
                x: centerX + 100,
                y: centerY + 150,
                radius: 45,
                baseRadius: 45,
                color: '#9966cc',
                gradient: ['#9966cc', '#6b46c1'],
                activity: 0,
                pulse: 0,
                awsService: 'ELB',
                instanceType: 'Application LB',
                vCPUs: 'Managed',
                memory: 'Managed',
                utilization: 25,
                throughput: '10k requests/sec',
                latency: 3,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.95,
                costPerHour: 35,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(4),
                membrane: { thickness: 2, opacity: 0.8 },
                reliabilityScore: 99.8
            });

            // Container Registry
            this.services.push({
                id: 'ECR_REGISTRY',
                name: 'ECR Container Registry',
                x: centerX,
                y: centerY + 250,
                radius: 40,
                baseRadius: 40,
                color: '#ffa502',
                gradient: ['#ffa502', '#ff9500'],
                activity: 0,
                pulse: 0,
                awsService: 'ECR',
                instanceType: 'Container Registry',
                vCPUs: 'N/A',
                memory: 'N/A',
                utilization: 15,
                throughput: '500 pulls/min',
                latency: 12,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 259200000,
                slaTarget: 99.9,
                costPerHour: 15,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(3),
                membrane: { thickness: 2, opacity: 0.8 },
                reliabilityScore: 99.6
            });
        }

        initializeBatchTemplate() {
            const centerX = this.canvas.width / 4;
            const centerY = this.canvas.height / 4;

            // AWS Batch Compute Environment
            this.services.push({
                id: 'BATCH_COMPUTE_ENV',
                name: 'Batch Compute Environment',
                x: centerX,
                y: centerY - 200,
                radius: 80,
                baseRadius: 80,
                color: '#ff6b6b',
                gradient: ['#ff6b6b', '#ff4757'],
                activity: 0,
                pulse: 0,
                awsService: 'Batch',
                instanceType: 'Managed Compute',
                vCPUs: 'Auto-scaling',
                memory: 'Auto-scaling',
                utilization: 75,
                throughput: '2.5k jobs/hour',
                latency: 45,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 86400000,
                slaTarget: 99.0,
                costPerHour: 650,
                isSpot: true,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(15),
                membrane: { thickness: 6, opacity: 0.95 },
                reliabilityScore: 98.9
            });

            // HPC Instance Cluster 1
            this.services.push({
                id: 'HPC_CLUSTER_1',
                name: 'HPC GPU Cluster',
                x: centerX - 300,
                y: centerY,
                radius: 70,
                baseRadius: 70,
                color: '#ff9500',
                gradient: ['#ff9500', '#ff6b35'],
                activity: 0,
                pulse: 0,
                awsService: 'Batch',
                instanceType: 'p4de.24xlarge',
                vCPUs: 96,
                memory: 1152,
                utilization: 95,
                throughput: '1.8k tokens/sec',
                latency: 28,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 43200000,
                slaTarget: 98.5,
                costPerHour: 580,
                isSpot: true,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(12),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 98.2
            });

            // HPC Instance Cluster 2
            this.services.push({
                id: 'HPC_CLUSTER_2',
                name: 'HPC CPU Cluster',
                x: centerX + 300,
                y: centerY,
                radius: 65,
                baseRadius: 65,
                color: '#00d4aa',
                gradient: ['#00d4aa', '#0080ff'],
                activity: 0,
                pulse: 0,
                awsService: 'Batch',
                instanceType: 'hpc6a.48xlarge',
                vCPUs: 96,
                memory: 384,
                utilization: 82,
                throughput: '1.2k jobs/sec',
                latency: 15,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 21600000,
                slaTarget: 98.5,
                costPerHour: 425,
                isSpot: true,
                availabilityZone: 'us-east-1b',
                organelles: this.createOrganelles(10),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 98.1
            });

            // Job Queue Manager
            this.services.push({
                id: 'BATCH_JOB_QUEUE',
                name: 'Job Queue Manager',
                x: centerX,
                y: centerY + 200,
                radius: 55,
                baseRadius: 55,
                color: '#9966cc',
                gradient: ['#9966cc', '#6b46c1'],
                activity: 0,
                pulse: 0,
                awsService: 'Batch',
                instanceType: 'Job Scheduler',
                vCPUs: 'Managed',
                memory: 'Managed',
                utilization: 45,
                throughput: '500 jobs/min',
                latency: 5,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.5,
                costPerHour: 85,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(8),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.3
            });

            // FSx Lustre High-Performance Storage
            this.services.push({
                id: 'FSX_LUSTRE',
                name: 'FSx Lustre Storage',
                x: centerX - 150,
                y: centerY + 300,
                radius: 50,
                baseRadius: 50,
                color: '#ff6b35',
                gradient: ['#ff6b35', '#ff4757'],
                activity: 0,
                pulse: 0,
                awsService: 'FSx',
                instanceType: 'Lustre HPC Storage',
                vCPUs: 'N/A',
                memory: 'N/A',
                utilization: 55,
                throughput: '100 GB/s',
                latency: 2,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 259200000,
                slaTarget: 99.9,
                costPerHour: 185,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(6),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 99.4
            });
        }

        initializeEMRTemplate() {
            const centerX = this.canvas.width / 4;
            const centerY = this.canvas.height / 4;

            // EMR Master Node
            this.services.push({
                id: 'EMR_MASTER',
                name: 'EMR Master Node',
                x: centerX,
                y: centerY - 200,
                radius: 70,
                baseRadius: 70,
                color: '#4caf50',
                gradient: ['#4caf50', '#2e7d32'],
                activity: 0,
                pulse: 0,
                awsService: 'EMR',
                instanceType: 'm5.2xlarge',
                vCPUs: 8,
                memory: 32,
                utilization: 55,
                throughput: '1k jobs/sec',
                latency: 15,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.5,
                costPerHour: 125,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(8),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.2
            });

            // Spark Worker Nodes
            this.services.push({
                id: 'SPARK_WORKERS',
                name: 'Spark Worker Nodes',
                x: centerX - 280,
                y: centerY,
                radius: 65,
                baseRadius: 65,
                color: '#ff9500',
                gradient: ['#ff9500', '#ff6b35'],
                activity: 0,
                pulse: 0,
                awsService: 'EMR',
                instanceType: 'r5.8xlarge',
                vCPUs: 32,
                memory: 256,
                utilization: 78,
                throughput: '2.2k partitions/sec',
                latency: 25,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 86400000,
                slaTarget: 99.0,
                costPerHour: 385,
                isSpot: true,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(12),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 98.8
            });

            // GPU Accelerated Nodes
            this.services.push({
                id: 'EMR_GPU_NODES',
                name: 'GPU Accelerated Nodes',
                x: centerX + 280,
                y: centerY,
                radius: 68,
                baseRadius: 68,
                color: '#00d4aa',
                gradient: ['#00d4aa', '#0080ff'],
                activity: 0,
                pulse: 0,
                awsService: 'EMR',
                instanceType: 'p3.8xlarge',
                vCPUs: 32,
                memory: 244,
                utilization: 88,
                throughput: '1.5k tokens/sec',
                latency: 35,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 43200000,
                slaTarget: 99.0,
                costPerHour: 465,
                isSpot: true,
                availabilityZone: 'us-east-1b',
                organelles: this.createOrganelles(11),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 98.6
            });

            // HDFS Storage Layer
            this.services.push({
                id: 'HDFS_STORAGE',
                name: 'HDFS Distributed Storage',
                x: centerX,
                y: centerY + 200,
                radius: 60,
                baseRadius: 60,
                color: '#ff6b35',
                gradient: ['#ff6b35', '#ff4757'],
                activity: 0,
                pulse: 0,
                awsService: 'EMR',
                instanceType: 'HDFS Cluster',
                vCPUs: 'Distributed',
                memory: 'Distributed',
                utilization: 65,
                throughput: '5.5 GB/s',
                latency: 8,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 259200000,
                slaTarget: 99.5,
                costPerHour: 225,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(9),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.1
            });

            // Jupyter Hub for ML Development
            this.services.push({
                id: 'JUPYTER_HUB',
                name: 'Jupyter Hub',
                x: centerX - 150,
                y: centerY + 300,
                radius: 45,
                baseRadius: 45,
                color: '#9966cc',
                gradient: ['#9966cc', '#6b46c1'],
                activity: 0,
                pulse: 0,
                awsService: 'EMR',
                instanceType: 'm5.xlarge',
                vCPUs: 4,
                memory: 16,
                utilization: 35,
                throughput: '50 notebooks/hour',
                latency: 12,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.0,
                costPerHour: 55,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(5),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 98.9
            });
        }

        initializeFargateTemplate() {
            const centerX = this.canvas.width / 4;
            const centerY = this.canvas.height / 4;

            // Fargate Service Manager
            this.services.push({
                id: 'FARGATE_SERVICE',
                name: 'Fargate Service Manager',
                x: centerX,
                y: centerY - 200,
                radius: 70,
                baseRadius: 70,
                color: '#ff8a65',
                gradient: ['#ff8a65', '#ff5722'],
                activity: 0,
                pulse: 0,
                awsService: 'Fargate',
                instanceType: 'Serverless Container',
                vCPUs: 'Auto-scaling',
                memory: 'Auto-scaling',
                utilization: 65,
                throughput: '1.8k tasks/hour',
                latency: 25,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 86400000,
                slaTarget: 99.5,
                costPerHour: 285,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(10),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.3
            });

            // Training Task Cluster
            this.services.push({
                id: 'TRAINING_TASKS',
                name: 'Training Task Cluster',
                x: centerX - 250,
                y: centerY - 50,
                radius: 65,
                baseRadius: 65,
                color: '#00d4aa',
                gradient: ['#00d4aa', '#0080ff'],
                activity: 0,
                pulse: 0,
                awsService: 'Fargate',
                instanceType: '16 vCPU, 32GB',
                vCPUs: 16,
                memory: 32,
                utilization: 82,
                throughput: '950 tokens/sec',
                latency: 35,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 43200000,
                slaTarget: 99.0,
                costPerHour: 195,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(11),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 99.1
            });

            // Data Processing Tasks
            this.services.push({
                id: 'DATA_PROCESSING_TASKS',
                name: 'Data Processing Tasks',
                x: centerX + 250,
                y: centerY - 50,
                radius: 60,
                baseRadius: 60,
                color: '#ffa502',
                gradient: ['#ffa502', '#ff9500'],
                activity: 0,
                pulse: 0,
                awsService: 'Fargate',
                instanceType: '8 vCPU, 16GB',
                vCPUs: 8,
                memory: 16,
                utilization: 70,
                throughput: '1.2k records/sec',
                latency: 18,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 21600000,
                slaTarget: 99.0,
                costPerHour: 125,
                isSpot: false,
                availabilityZone: 'us-east-1b',
                organelles: this.createOrganelles(9),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.0
            });

            // Auto Scaling Manager
            this.services.push({
                id: 'AUTO_SCALING_MANAGER',
                name: 'Auto Scaling Manager',
                x: centerX,
                y: centerY + 150,
                radius: 55,
                baseRadius: 55,
                color: '#9966cc',
                gradient: ['#9966cc', '#6b46c1'],
                activity: 0,
                pulse: 0,
                awsService: 'ECS',
                instanceType: 'Service Auto Scaling',
                vCPUs: 'Managed',
                memory: 'Managed',
                utilization: 35,
                throughput: '500 scale events/hour',
                latency: 8,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.9,
                costPerHour: 45,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(6),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 99.6
            });

            // Application Load Balancer
            this.services.push({
                id: 'ALB_FARGATE',
                name: 'Application Load Balancer',
                x: centerX - 150,
                y: centerY + 250,
                radius: 50,
                baseRadius: 50,
                color: '#ff6b6b',
                gradient: ['#ff6b6b', '#ff4757'],
                activity: 0,
                pulse: 0,
                awsService: 'ELB',
                instanceType: 'Application LB',
                vCPUs: 'Managed',
                memory: 'Managed',
                utilization: 28,
                throughput: '15k requests/sec',
                latency: 2,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 259200000,
                slaTarget: 99.95,
                costPerHour: 35,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(5),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 99.8
            });

            // CloudWatch Logs & Metrics
            this.services.push({
                id: 'CLOUDWATCH_FARGATE',
                name: 'CloudWatch Monitoring',
                x: centerX + 150,
                y: centerY + 250,
                radius: 45,
                baseRadius: 45,
                color: '#ff9500',
                gradient: ['#ff9500', '#ff6b35'],
                activity: 0,
                pulse: 0,
                awsService: 'CloudWatch',
                instanceType: 'Managed Service',
                vCPUs: 'N/A',
                memory: 'N/A',
                utilization: 22,
                throughput: '25k metrics/sec',
                latency: 5,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 259200000,
                slaTarget: 99.9,
                costPerHour: 28,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(4),
                membrane: { thickness: 2, opacity: 0.8 },
                reliabilityScore: 99.7
            });
        }

        initializeParallelClusterTemplate() {
            const centerX = this.canvas.width / 4;
            const centerY = this.canvas.height / 4;

            // ParallelCluster Head Node
            this.services.push({
                id: 'PARALLELCLUSTER_HEAD',
                name: 'ParallelCluster Head Node',
                x: centerX,
                y: centerY - 220,
                radius: 75,
                baseRadius: 75,
                color: '#9c27b0',
                gradient: ['#9c27b0', '#6a1b9a'],
                activity: 0,
                pulse: 0,
                awsService: 'ParallelCluster',
                instanceType: 'c5n.4xlarge',
                vCPUs: 16,
                memory: 42,
                utilization: 45,
                throughput: '2k job submissions/hour',
                latency: 8,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.5,
                costPerHour: 185,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(10),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 99.4
            });

            // GPU Compute Nodes
            this.services.push({
                id: 'GPU_COMPUTE_NODES',
                name: 'GPU Compute Nodes',
                x: centerX - 280,
                y: centerY - 50,
                radius: 70,
                baseRadius: 70,
                color: '#ff9500',
                gradient: ['#ff9500', '#ff6b35'],
                activity: 0,
                pulse: 0,
                awsService: 'ParallelCluster',
                instanceType: 'p4d.24xlarge',
                vCPUs: 96,
                memory: 1152,
                utilization: 92,
                throughput: '2.2k tokens/sec',
                latency: 32,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 86400000,
                slaTarget: 98.5,
                costPerHour: 520,
                isSpot: true,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(14),
                membrane: { thickness: 6, opacity: 0.95 },
                reliabilityScore: 98.7
            });

            // CPU Compute Nodes
            this.services.push({
                id: 'CPU_COMPUTE_NODES',
                name: 'CPU Compute Nodes',
                x: centerX + 280,
                y: centerY - 50,
                radius: 65,
                baseRadius: 65,
                color: '#00d4aa',
                gradient: ['#00d4aa', '#0080ff'],
                activity: 0,
                pulse: 0,
                awsService: 'ParallelCluster',
                instanceType: 'hpc6a.48xlarge',
                vCPUs: 96,
                memory: 384,
                utilization: 85,
                throughput: '1.8k jobs/sec',
                latency: 18,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 43200000,
                slaTarget: 98.5,
                costPerHour: 425,
                isSpot: true,
                availabilityZone: 'us-east-1b',
                organelles: this.createOrganelles(12),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 98.5
            });

            // Slurm Scheduler
            this.services.push({
                id: 'SLURM_SCHEDULER',
                name: 'Slurm Job Scheduler',
                x: centerX,
                y: centerY + 150,
                radius: 60,
                baseRadius: 60,
                color: '#ff6b35',
                gradient: ['#ff6b35', '#ff4757'],
                activity: 0,
                pulse: 0,
                awsService: 'ParallelCluster',
                instanceType: 'Job Scheduler',
                vCPUs: 'Managed',
                memory: 'Managed',
                utilization: 55,
                throughput: '1.5k jobs/hour',
                latency: 3,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 259200000,
                slaTarget: 99.0,
                costPerHour: 95,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(8),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.1
            });

            // Shared Storage (FSx Lustre)
            this.services.push({
                id: 'FSX_SHARED_STORAGE',
                name: 'FSx Shared Storage',
                x: centerX - 180,
                y: centerY + 280,
                radius: 55,
                baseRadius: 55,
                color: '#9966cc',
                gradient: ['#9966cc', '#6b46c1'],
                activity: 0,
                pulse: 0,
                awsService: 'FSx',
                instanceType: 'Lustre Storage',
                vCPUs: 'N/A',
                memory: 'N/A',
                utilization: 65,
                throughput: '200 GB/s',
                latency: 1,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 345600000,
                slaTarget: 99.9,
                costPerHour: 225,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(7),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.6
            });

            // Environment Manager
            this.services.push({
                id: 'ENV_MANAGER',
                name: 'Environment Manager',
                x: centerX + 180,
                y: centerY + 280,
                radius: 50,
                baseRadius: 50,
                color: '#ffa502',
                gradient: ['#ffa502', '#ff9500'],
                activity: 0,
                pulse: 0,
                awsService: 'ParallelCluster',
                instanceType: 'Management Service',
                vCPUs: 'Managed',
                memory: 'Managed',
                utilization: 25,
                throughput: '200 env changes/hour',
                latency: 12,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 259200000,
                slaTarget: 99.5,
                costPerHour: 65,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(5),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 99.3
            });
        }

        initializeHybridTemplate() {
            const centerX = this.canvas.width / 4;
            const centerY = this.canvas.height / 4;

            // AWS Direct Connect Gateway
            this.services.push({
                id: 'DIRECT_CONNECT',
                name: 'Direct Connect Gateway',
                x: centerX,
                y: centerY - 250,
                radius: 70,
                baseRadius: 70,
                color: '#ff6b6b',
                gradient: ['#ff6b6b', '#ff4757'],
                activity: 0,
                pulse: 0,
                awsService: 'DirectConnect',
                instanceType: '100Gbps Connection',
                vCPUs: 'N/A',
                memory: 'N/A',
                utilization: 35,
                throughput: '80 Gbps',
                latency: 2,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 2592000000,
                slaTarget: 99.95,
                costPerHour: 285,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(8),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.8
            });

            // On-Premises Data Center
            this.services.push({
                id: 'ON_PREMISES_DC',
                name: 'On-Premises Data Center',
                x: centerX - 300,
                y: centerY - 100,
                radius: 75,
                baseRadius: 75,
                color: '#607d8b',
                gradient: ['#607d8b', '#455a64'],
                activity: 0,
                pulse: 0,
                awsService: 'On-Premises',
                instanceType: 'Physical Servers',
                vCPUs: 'Variable',
                memory: 'Variable',
                utilization: 78,
                throughput: '1.5k tokens/sec',
                latency: 45,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 7776000000,
                slaTarget: 98.0,
                costPerHour: 650,
                isSpot: false,
                availabilityZone: 'On-Premises',
                organelles: this.createOrganelles(12),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 97.8
            });

            // AWS Outposts
            this.services.push({
                id: 'AWS_OUTPOSTS',
                name: 'AWS Outposts',
                x: centerX + 300,
                y: centerY - 100,
                radius: 68,
                baseRadius: 68,
                color: '#ff9500',
                gradient: ['#ff9500', '#ff6b35'],
                activity: 0,
                pulse: 0,
                awsService: 'Outposts',
                instanceType: 'Hybrid Infrastructure',
                vCPUs: 768,
                memory: 6144,
                utilization: 72,
                throughput: '1.8k tokens/sec',
                latency: 25,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 1296000000,
                slaTarget: 99.0,
                costPerHour: 485,
                isSpot: false,
                availabilityZone: 'Outposts',
                organelles: this.createOrganelles(11),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 98.9
            });

            // Multi-Cloud Orchestrator
            this.services.push({
                id: 'MULTI_CLOUD_ORCHESTRATOR',
                name: 'Multi-Cloud Orchestrator',
                x: centerX,
                y: centerY + 150,
                radius: 65,
                baseRadius: 65,
                color: '#9966cc',
                gradient: ['#9966cc', '#6b46c1'],
                activity: 0,
                pulse: 0,
                awsService: 'EKS',
                instanceType: 'Hybrid Orchestration',
                vCPUs: 'Distributed',
                memory: 'Distributed',
                utilization: 58,
                throughput: '800 workflows/hour',
                latency: 15,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.5,
                costPerHour: 325,
                isSpot: false,
                availabilityZone: 'Multi-Cloud',
                organelles: this.createOrganelles(10),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.2
            });

            // Edge Computing Nodes
            this.services.push({
                id: 'EDGE_COMPUTING',
                name: 'Edge Computing Nodes',
                x: centerX - 200,
                y: centerY + 280,
                radius: 55,
                baseRadius: 55,
                color: '#00d4aa',
                gradient: ['#00d4aa', '#0080ff'],
                activity: 0,
                pulse: 0,
                awsService: 'Wavelength',
                instanceType: 'Edge Instances',
                vCPUs: 48,
                memory: 192,
                utilization: 65,
                throughput: '650 inferences/sec',
                latency: 8,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 86400000,
                slaTarget: 98.5,
                costPerHour: 225,
                isSpot: false,
                availabilityZone: 'Edge Locations',
                organelles: this.createOrganelles(7),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 98.6
            });

            // Global Load Balancer
            this.services.push({
                id: 'GLOBAL_LOAD_BALANCER',
                name: 'Global Load Balancer',
                x: centerX + 200,
                y: centerY + 280,
                radius: 50,
                baseRadius: 50,
                color: '#ffa502',
                gradient: ['#ffa502', '#ff9500'],
                activity: 0,
                pulse: 0,
                awsService: 'CloudFront',
                instanceType: 'Global CDN',
                vCPUs: 'Global',
                memory: 'Global',
                utilization: 42,
                throughput: '50k requests/sec',
                latency: 3,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 259200000,
                slaTarget: 99.9,
                costPerHour: 125,
                isSpot: false,
                availabilityZone: 'Global',
                organelles: this.createOrganelles(6),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 99.7
            });
        }

        initializeFederatedTemplate() {
            const centerX = this.canvas.width / 4;
            const centerY = this.canvas.height / 4;

            // Central Aggregation Server
            this.services.push({
                id: 'FEDERATED_AGGREGATOR',
                name: 'Federated Aggregator',
                x: centerX,
                y: centerY - 200,
                radius: 75,
                baseRadius: 75,
                color: '#e91e63',
                gradient: ['#e91e63', '#ad1457'],
                activity: 0,
                pulse: 0,
                awsService: 'EKS',
                instanceType: 'Federated Coordinator',
                vCPUs: 32,
                memory: 128,
                utilization: 55,
                throughput: '200 model updates/hour',
                latency: 25,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.5,
                costPerHour: 285,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(12),
                membrane: { thickness: 5, opacity: 0.95 },
                reliabilityScore: 99.3
            });

            // Edge Device Cluster 1
            this.services.push({
                id: 'EDGE_CLUSTER_1',
                name: 'Mobile Edge Devices',
                x: centerX - 300,
                y: centerY - 50,
                radius: 60,
                baseRadius: 60,
                color: '#ff9500',
                gradient: ['#ff9500', '#ff6b35'],
                activity: 0,
                pulse: 0,
                awsService: 'IoT Greengrass',
                instanceType: 'Mobile Devices',
                vCPUs: 'Variable',
                memory: 'Variable',
                utilization: 45,
                throughput: '150 local updates/hour',
                latency: 12,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 86400000,
                slaTarget: 95.0,
                costPerHour: 85,
                isSpot: false,
                availabilityZone: 'Edge-Mobile',
                organelles: this.createOrganelles(8),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 96.5
            });

            // Edge Device Cluster 2
            this.services.push({
                id: 'EDGE_CLUSTER_2',
                name: 'Hospital Edge Nodes',
                x: centerX + 300,
                y: centerY - 50,
                radius: 65,
                baseRadius: 65,
                color: '#00d4aa',
                gradient: ['#00d4aa', '#0080ff'],
                activity: 0,
                pulse: 0,
                awsService: 'IoT Greengrass',
                instanceType: 'Healthcare Edge',
                vCPUs: 16,
                memory: 64,
                utilization: 68,
                throughput: '280 local inferences/hour',
                latency: 8,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 43200000,
                slaTarget: 98.0,
                costPerHour: 145,
                isSpot: false,
                availabilityZone: 'Edge-Healthcare',
                organelles: this.createOrganelles(9),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 97.8
            });

            // Privacy-Preserving Coordinator
            this.services.push({
                id: 'PRIVACY_COORDINATOR',
                name: 'Privacy Coordinator',
                x: centerX,
                y: centerY + 150,
                radius: 58,
                baseRadius: 58,
                color: '#9966cc',
                gradient: ['#9966cc', '#6b46c1'],
                activity: 0,
                pulse: 0,
                awsService: 'Lambda',
                instanceType: 'Privacy Engine',
                vCPUs: 12,
                memory: 48,
                utilization: 35,
                throughput: '500 privacy checks/hour',
                latency: 15,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 259200000,
                slaTarget: 99.9,
                costPerHour: 125,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(7),
                membrane: { thickness: 4, opacity: 0.9 },
                reliabilityScore: 99.6
            });

            // Differential Privacy Engine
            this.services.push({
                id: 'DIFFERENTIAL_PRIVACY',
                name: 'Differential Privacy Engine',
                x: centerX - 180,
                y: centerY + 280,
                radius: 50,
                baseRadius: 50,
                color: '#ff6b35',
                gradient: ['#ff6b35', '#ff4757'],
                activity: 0,
                pulse: 0,
                awsService: 'Lambda',
                instanceType: 'Privacy Preserving',
                vCPUs: 8,
                memory: 32,
                utilization: 28,
                throughput: '1k noise injections/hour',
                latency: 5,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 172800000,
                slaTarget: 99.5,
                costPerHour: 85,
                isSpot: false,
                availabilityZone: 'us-east-1a',
                organelles: this.createOrganelles(5),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 99.1
            });

            // Secure Communication Hub
            this.services.push({
                id: 'SECURE_COMM_HUB',
                name: 'Secure Communication Hub',
                x: centerX + 180,
                y: centerY + 280,
                radius: 52,
                baseRadius: 52,
                color: '#ffa502',
                gradient: ['#ffa502', '#ff9500'],
                activity: 0,
                pulse: 0,
                awsService: 'KMS',
                instanceType: 'Encrypted Communication',
                vCPUs: 'Managed',
                memory: 'Managed',
                utilization: 22,
                throughput: '2k encrypted msgs/hour',
                latency: 3,
                healthStatus: 'Healthy',
                launchTime: Date.now() - 345600000,
                slaTarget: 99.9,
                costPerHour: 95,
                isSpot: false,
                availabilityZone: 'Multi-AZ',
                organelles: this.createOrganelles(6),
                membrane: { thickness: 3, opacity: 0.85 },
                reliabilityScore: 99.8
            });
        }

        // Utility method to create organelles for services
        createOrganelles(count) {
            const organelles = [];
            for (let i = 0; i < count; i++) {
                organelles.push({
                    x: (Math.random() - 0.5) * 80,
                    y: (Math.random() - 0.5) * 80,
                    radius: 3 + Math.random() * 6,
                    speed: 0.3 + Math.random() * 0.8,
                    angle: Math.random() * Math.PI * 2,
                    color: `hsl(${200 + Math.random() * 80}, 70%, 65%)`
                });
            }
            return organelles;
        }

        // Update legend based on current template
        updateLegend() {
            const legendContent = document.getElementById('legendContent');
            const architectureContent = document.getElementById('architectureContent');
            const template = this.currentTemplate;

            let legendHTML = '';
            let architectureHTML = '';

            switch (template) {
                case 'standard':
                    legendHTML = `
                        <div class="legend-section">
                            <h4>Compute Services</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff9500, #ff6b35);"></div>
                                <span>EC2 Training Instances</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #00d4aa, #0080ff);"></div>
                                <span>SageMaker Training Jobs</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #9966cc, #6b46c1);"></div>
                                <span>Bedrock Foundation Models</span>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Data & Storage</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff6b35, #ff4757);"></div>
                                <span>S3 Data Lake</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ffa502, #ff9500);"></div>
                                <span>Lambda Functions</span>
                            </div>
                        </div>`;

                    architectureHTML = `
                        <div class="arch-section">
                            <h4>Core Components</h4>
                            <ul class="component-list">
                                <li><strong>S3 Data Lake:</strong> Centralized storage for training datasets, model artifacts, and checkpoints</li>
                                <li><strong>SageMaker Training:</strong> Managed ML training with built-in algorithms and custom containers</li>
                                <li><strong>EC2 Training Cluster:</strong> Distributed training across multiple GPU instances (p4d.24xlarge)</li>
                                <li><strong>Bedrock Foundation Models:</strong> Pre-trained LLMs for fine-tuning and inference</li>
                                <li><strong>Lambda Data Pipeline:</strong> Serverless data preprocessing and transformation</li>
                                <li><strong>ECS Model Serving:</strong> Containerized model deployment and inference</li>
                                <li><strong>CloudWatch Monitoring:</strong> Real-time metrics, logs, and alerting</li>
                            </ul>
                        </div>

                        <div class="arch-section">
                            <h4>Training Workflow</h4>
                            <div class="workflow-step">1. Data ingestion from multiple sources into S3 Data Lake</div>
                            <div class="workflow-step">2. Lambda functions preprocess and validate data quality</div>
                            <div class="workflow-step">3. SageMaker orchestrates distributed training across EC2 instances</div>
                            <div class="workflow-step">4. Model checkpoints saved to S3 with versioning</div>
                            <div class="workflow-step">5. Trained models deployed via ECS for inference</div>
                            <div class="workflow-step">6. CloudWatch monitors performance and costs</div>
                        </div>

                        <div class="benefits-list">
                            <h5>Key Benefits</h5>
                            <ul>
                                <li>Managed services reduce operational overhead</li>
                                <li>Auto-scaling for cost optimization</li>
                                <li>Integrated with AWS ML ecosystem</li>
                                <li>Built-in security and compliance</li>
                                <li>Pay-per-use pricing model</li>
                            </ul>
                        </div>

                        <div class="cost-estimate">
                            <div class="cost-label">Estimated Monthly Cost</div>
                            <div class="cost-value">$19,500 - $35,000</div>
                        </div>`;
                    break;

                case 'eks-kubernetes':
                    legendHTML = `
                        <div class="legend-section">
                            <h4>Kubernetes Services</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #326ce5, #1565c0);"></div>
                                <span>EKS Control Plane</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff9500, #ff6b35);"></div>
                                <span>GPU Worker Nodes</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #00d4aa, #0080ff);"></div>
                                <span>CPU Worker Nodes</span>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Storage & Networking</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff6b35, #ff4757);"></div>
                                <span>EFS Shared Storage</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #9966cc, #6b46c1);"></div>
                                <span>Application Load Balancer</span>
                            </div>
                        </div>`;

                    architectureHTML = `
                        <div class="arch-section">
                            <h4>Kubernetes Components</h4>
                            <ul class="component-list">
                                <li><strong>EKS Control Plane:</strong> Managed Kubernetes API server with HA across AZs</li>
                                <li><strong>GPU Worker Nodes:</strong> P4d instances for intensive ML training workloads</li>
                                <li><strong>CPU Worker Nodes:</strong> C5n instances for data processing and orchestration</li>
                                <li><strong>EFS Shared Storage:</strong> NFS-compatible shared file system for datasets</li>
                                <li><strong>ALB Load Balancer:</strong> Traffic distribution and SSL termination</li>
                                <li><strong>ECR Registry:</strong> Private container registry for ML training images</li>
                            </ul>
                        </div>

                        <div class="arch-section">
                            <h4>Container Orchestration</h4>
                            <div class="workflow-step">1. ML training jobs deployed as Kubernetes pods</div>
                            <div class="workflow-step">2. HPA scales pods based on CPU/GPU utilization</div>
                            <div class="workflow-step">3. Node autoscaler provisions EC2 instances as needed</div>
                            <div class="workflow-step">4. Jobs access shared datasets via EFS volumes</div>
                            <div class="workflow-step">5. Service mesh manages inter-pod communication</div>
                            <div class="workflow-step">6. Helm charts manage complex ML pipeline deployments</div>
                        </div>

                        <div class="benefits-list">
                            <h5>Container Advantages</h5>
                            <ul>
                                <li>Cloud-native microservices architecture</li>
                                <li>Horizontal pod autoscaling</li>
                                <li>Rolling updates with zero downtime</li>
                                <li>Resource isolation and multi-tenancy</li>
                                <li>Portable across cloud providers</li>
                            </ul>
                        </div>

                        <div class="cost-estimate">
                            <div class="cost-label">Estimated Monthly Cost</div>
                            <div class="cost-value">$23,200 - $42,000</div>
                        </div>`;
                    break;

                case 'batch-hpc':
                    legendHTML = `
                        <div class="legend-section">
                            <h4>HPC Components</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff6b6b, #ff4757);"></div>
                                <span>Batch Compute Environment</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff9500, #ff6b35);"></div>
                                <span>HPC GPU Cluster</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #00d4aa, #0080ff);"></div>
                                <span>HPC CPU Cluster</span>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Scheduling & Storage</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #9966cc, #6b46c1);"></div>
                                <span>Job Queue Manager</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff6b35, #ff4757);"></div>
                                <span>FSx Lustre Storage</span>
                            </div>
                        </div>`;

                    architectureHTML = `
                        <div class="arch-section">
                            <h4>HPC Infrastructure</h4>
                            <ul class="component-list">
                                <li><strong>Batch Compute Environment:</strong> Auto-scaling HPC clusters with spot pricing</li>
                                <li><strong>HPC GPU Cluster:</strong> P4de instances with NVLink for multi-GPU training</li>
                                <li><strong>HPC CPU Cluster:</strong> Hpc6a instances optimized for compute-intensive tasks</li>
                                <li><strong>Job Queue Manager:</strong> Priority-based scheduling and resource allocation</li>
                                <li><strong>FSx Lustre Storage:</strong> High-performance parallel file system (200GB/s)</li>
                                <li><strong>Placement Groups:</strong> Low-latency 10Gbps networking between nodes</li>
                            </ul>
                        </div>

                        <div class="arch-section">
                            <h4>HPC Workflow</h4>
                            <div class="workflow-step">1. Large-scale training jobs submitted to Batch queue</div>
                            <div class="workflow-step">2. Scheduler provisions optimal instance mix (GPU/CPU)</div>
                            <div class="workflow-step">3. MPI framework distributes work across nodes</div>
                            <div class="workflow-step">4. High-speed Lustre storage enables parallel I/O</div>
                            <div class="workflow-step">5. Spot instances reduce costs by up to 70%</div>
                            <div class="workflow-step">6. Array jobs enable massive parallel processing</div>
                        </div>

                        <div class="benefits-list">
                            <h5>HPC Advantages</h5>
                            <ul>
                                <li>Massive parallel processing capabilities</li>
                                <li>Ultra-low latency networking</li>
                                <li>Cost-effective spot instance usage</li>
                                <li>Scientific computing optimizations</li>
                                <li>Scales to thousands of cores</li>
                            </ul>
                        </div>

                        <div class="cost-estimate">
                            <div class="cost-label">Estimated Monthly Cost</div>
                            <div class="cost-value">$35,800 - $65,000</div>
                        </div>`;
                    break;

                case 'emr-spark':
                    legendHTML = `
                        <div class="legend-section">
                            <h4>EMR Cluster</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #4caf50, #2e7d32);"></div>
                                <span>EMR Master Node</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff9500, #ff6b35);"></div>
                                <span>Spark Worker Nodes</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #00d4aa, #0080ff);"></div>
                                <span>GPU Accelerated Nodes</span>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Storage & Development</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff6b35, #ff4757);"></div>
                                <span>HDFS Distributed Storage</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #9966cc, #6b46c1);"></div>
                                <span>Jupyter Hub</span>
                            </div>
                        </div>`;

                    architectureHTML = `
                        <div class="arch-section">
                            <h4>Spark Ecosystem</h4>
                            <ul class="component-list">
                                <li><strong>EMR Master Node:</strong> Spark driver and cluster resource manager</li>
                                <li><strong>Spark Worker Nodes:</strong> R5 instances for in-memory data processing</li>
                                <li><strong>GPU Accelerated Nodes:</strong> P3 instances with Rapids for GPU-accelerated ML</li>
                                <li><strong>HDFS Storage:</strong> Distributed file system with 3x replication</li>
                                <li><strong>Jupyter Hub:</strong> Multi-user notebook environment for data scientists</li>
                                <li><strong>Hive Metastore:</strong> Centralized metadata catalog for datasets</li>
                            </ul>
                        </div>

                        <div class="arch-section">
                            <h4>Distributed Processing</h4>
                            <div class="workflow-step">1. Massive datasets loaded into HDFS across cluster</div>
                            <div class="workflow-step">2. Spark SQL queries partition data for parallel processing</div>
                            <div class="workflow-step">3. MLlib algorithms distributed across worker nodes</div>
                            <div class="workflow-step">4. GPU nodes accelerate deep learning workloads</div>
                            <div class="workflow-step">5. Dynamic allocation scales executors based on workload</div>
                            <div class="workflow-step">6. Results cached in memory for iterative algorithms</div>
                        </div>

                        <div class="benefits-list">
                            <h5>Big Data Benefits</h5>
                            <ul>
                                <li>Petabyte-scale data processing</li>
                                <li>In-memory computing for speed</li>
                                <li>Unified analytics platform</li>
                                <li>Advanced ML library integration</li>
                                <li>SQL interface for data analysts</li>
                            </ul>
                        </div>

                        <div class="cost-estimate">
                            <div class="cost-label">Estimated Monthly Cost</div>
                            <div class="cost-value">$28,500 - $48,000</div>
                        </div>`;
                    break;

                case 'fargate-serverless':
                    legendHTML = `
                        <div class="legend-section">
                            <h4>Serverless Components</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff8a65, #ff5722);"></div>
                                <span>Fargate Service Manager</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #00d4aa, #0080ff);"></div>
                                <span>Training Task Cluster</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ffa502, #ff9500);"></div>
                                <span>Data Processing Tasks</span>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Auto-Scaling & Monitoring</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #9966cc, #6b46c1);"></div>
                                <span>Auto Scaling Manager</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff6b6b, #ff4757);"></div>
                                <span>Application Load Balancer</span>
                            </div>
                        </div>`;

                    architectureHTML = `
                        <div class="arch-section">
                            <h4>Serverless Architecture</h4>
                            <ul class="component-list">
                                <li><strong>Fargate Service Manager:</strong> Serverless container orchestration</li>
                                <li><strong>Training Task Cluster:</strong> ML training containers with auto-scaling</li>
                                <li><strong>Data Processing Tasks:</strong> ETL pipelines as serverless containers</li>
                                <li><strong>Auto Scaling Manager:</strong> Target tracking and scheduled scaling</li>
                                <li><strong>ALB Load Balancer:</strong> Traffic distribution across tasks</li>
                                <li><strong>CloudWatch Integration:</strong> Container insights and custom metrics</li>
                            </ul>
                        </div>

                        <div class="arch-section">
                            <h4>Serverless Operations</h4>
                            <div class="workflow-step">1. Code packaged as container images in ECR</div>
                            <div class="workflow-step">2. Fargate launches tasks without managing servers</div>
                            <div class="workflow-step">3. Auto-scaling responds to demand in real-time</div>
                            <div class="workflow-step">4. Pay only for compute time used by containers</div>
                            <div class="workflow-step">5. Zero infrastructure management required</div>
                            <div class="workflow-step">6. Built-in security and compliance controls</div>
                        </div>

                        <div class="benefits-list">
                            <h5>Serverless Advantages</h5>
                            <ul>
                                <li>Zero server management overhead</li>
                                <li>Pay-per-use pricing model</li>
                                <li>Instant scaling from zero</li>
                                <li>Built-in fault tolerance</li>
                                <li>Focus on code, not infrastructure</li>
                            </ul>
                        </div>

                        <div class="cost-estimate">
                            <div class="cost-label">Estimated Monthly Cost</div>
                            <div class="cost-value">$14,200 - $28,500</div>
                        </div>`;
                    break;

                case 'parallelcluster':
                    legendHTML = `
                        <div class="legend-section">
                            <h4>HPC Cluster</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #9c27b0, #6a1b9a);"></div>
                                <span>ParallelCluster Head Node</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff9500, #ff6b35);"></div>
                                <span>GPU Compute Nodes</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #00d4aa, #0080ff);"></div>
                                <span>CPU Compute Nodes</span>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Scheduling & Storage</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff6b35, #ff4757);"></div>
                                <span>Slurm Job Scheduler</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #9966cc, #6b46c1);"></div>
                                <span>FSx Shared Storage</span>
                            </div>
                        </div>`;

                    architectureHTML = `
                        <div class="arch-section">
                            <h4>Scientific Computing</h4>
                            <ul class="component-list">
                                <li><strong>ParallelCluster Head Node:</strong> Login node with Slurm scheduler</li>
                                <li><strong>GPU Compute Nodes:</strong> P4d instances for AI/ML workloads</li>
                                <li><strong>CPU Compute Nodes:</strong> Hpc6a instances for parallel computing</li>
                                <li><strong>Slurm Scheduler:</strong> Workload manager with resource allocation</li>
                                <li><strong>FSx Lustre Storage:</strong> High-performance shared file system</li>
                                <li><strong>Environment Modules:</strong> Software environment management</li>
                            </ul>
                        </div>

                        <div class="arch-section">
                            <h4>Scientific Workflow</h4>
                            <div class="workflow-step">1. Research jobs submitted via Slurm scheduler</div>
                            <div class="workflow-step">2. Queue system allocates optimal resources</div>
                            <div class="workflow-step">3. MPI jobs span multiple nodes for parallel computing</div>
                            <div class="workflow-step">4. Shared storage accessible from all compute nodes</div>
                            <div class="workflow-step">5. Environment modules manage software stacks</div>
                            <div class="workflow-step">6. Job arrays enable parameter sweep studies</div>
                        </div>

                        <div class="benefits-list">
                            <h5>Research Benefits</h5>
                            <ul>
                                <li>Traditional HPC workflow compatibility</li>
                                <li>Scientific software pre-installed</li>
                                <li>Multi-user job scheduling</li>
                                <li>Cluster auto-scaling capabilities</li>
                                <li>Research-optimized instance types</li>
                            </ul>
                        </div>

                        <div class="cost-estimate">
                            <div class="cost-label">Estimated Monthly Cost</div>
                            <div class="cost-value">$52,500 - $95,000</div>
                        </div>`;
                    break;

                case 'hybrid-multicloud':
                    legendHTML = `
                        <div class="legend-section">
                            <h4>Hybrid Infrastructure</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff6b6b, #ff4757);"></div>
                                <span>Direct Connect Gateway</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #607d8b, #455a64);"></div>
                                <span>On-Premises Data Center</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff9500, #ff6b35);"></div>
                                <span>AWS Outposts</span>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Multi-Cloud Services</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #9966cc, #6b46c1);"></div>
                                <span>Multi-Cloud Orchestrator</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #00d4aa, #0080ff);"></div>
                                <span>Edge Computing Nodes</span>
                            </div>
                        </div>`;

                    architectureHTML = `
                        <div class="arch-section">
                            <h4>Hybrid Cloud Setup</h4>
                            <ul class="component-list">
                                <li><strong>Direct Connect Gateway:</strong> Dedicated 100Gbps network connection</li>
                                <li><strong>On-Premises Data Center:</strong> Existing infrastructure with sensitive data</li>
                                <li><strong>AWS Outposts:</strong> AWS hardware in your data center</li>
                                <li><strong>Multi-Cloud Orchestrator:</strong> Kubernetes federation across clouds</li>
                                <li><strong>Edge Computing Nodes:</strong> Wavelength zones for low latency</li>
                                <li><strong>Global Load Balancer:</strong> CloudFront with multi-origin support</li>
                            </ul>
                        </div>

                        <div class="arch-section">
                            <h4>Hybrid Orchestration</h4>
                            <div class="workflow-step">1. Sensitive data remains on-premises for compliance</div>
                            <div class="workflow-step">2. Training workloads burst to AWS when needed</div>
                            <div class="workflow-step">3. Outposts provide AWS services locally</div>
                            <div class="workflow-step">4. Edge nodes serve models with ultra-low latency</div>
                            <div class="workflow-step">5. Global orchestrator manages workload placement</div>
                            <div class="workflow-step">6. Cross-cloud data synchronization and backup</div>
                        </div>

                        <div class="benefits-list">
                            <h5>Hybrid Advantages</h5>
                            <ul>
                                <li>Data sovereignty and compliance</li>
                                <li>Burst capacity to cloud</li>
                                <li>Disaster recovery across locations</li>
                                <li>Optimize for latency and cost</li>
                                <li>Gradual cloud migration path</li>
                            </ul>
                        </div>

                        <div class="cost-estimate">
                            <div class="cost-label">Estimated Monthly Cost</div>
                            <div class="cost-value">$31,800 - $58,000</div>
                        </div>`;
                    break;

                case 'edge-federated':
                    legendHTML = `
                        <div class="legend-section">
                            <h4>Federated Learning</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #e91e63, #ad1457);"></div>
                                <span>Federated Aggregator</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff9500, #ff6b35);"></div>
                                <span>Mobile Edge Devices</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #00d4aa, #0080ff);"></div>
                                <span>Hospital Edge Nodes</span>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Privacy & Security</h4>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #9966cc, #6b46c1);"></div>
                                <span>Privacy Coordinator</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(45deg, #ff6b35, #ff4757);"></div>
                                <span>Differential Privacy Engine</span>
                            </div>
                        </div>`;

                    architectureHTML = `
                        <div class="arch-section">
                            <h4>Federated Components</h4>
                            <ul class="component-list">
                                <li><strong>Federated Aggregator:</strong> Central server coordinating learning rounds</li>
                                <li><strong>Mobile Edge Devices:</strong> Smartphones and IoT devices for local training</li>
                                <li><strong>Hospital Edge Nodes:</strong> Healthcare institutions with private data</li>
                                <li><strong>Privacy Coordinator:</strong> Ensures compliance with privacy regulations</li>
                                <li><strong>Differential Privacy Engine:</strong> Adds noise to protect individual privacy</li>
                                <li><strong>Secure Communication Hub:</strong> Encrypted model exchange protocols</li>
                            </ul>
                        </div>

                        <div class="arch-section">
                            <h4>Federated Learning Process</h4>
                            <div class="workflow-step">1. Global model distributed to participating edge devices</div>
                            <div class="workflow-step">2. Local training on private data at each location</div>
                            <div class="workflow-step">3. Model updates encrypted and sent to aggregator</div>
                            <div class="workflow-step">4. Differential privacy applied to protect individuals</div>
                            <div class="workflow-step">5. Updates aggregated without accessing raw data</div>
                            <div class="workflow-step">6. Improved global model distributed for next round</div>
                        </div>

                        <div class="benefits-list">
                            <h5>Privacy Benefits</h5>
                            <ul>
                                <li>Data never leaves source location</li>
                                <li>Mathematical privacy guarantees</li>
                                <li>Compliance with GDPR/HIPAA</li>
                                <li>Collective intelligence without sharing</li>
                                <li>Resilient to device failures</li>
                            </ul>
                        </div>

                        <div class="cost-estimate">
                            <div class="cost-label">Estimated Monthly Cost</div>
                            <div class="cost-value">$8,500 - $18,000</div>
                        </div>`;
                    break;

                default:
                    // Fallback to standard template
                    legendHTML = `
                        <div class="legend-section">
                            <h4>Select a template above to see architectural details</h4>
                        </div>`;
                    architectureHTML = `
                        <div class="arch-section">
                            <h4>Getting Started</h4>
                            <p>Choose a deployment template from the dropdown menu to explore different AWS GenAI LLM training architectures.</p>
                        </div>`;
            }

            legendContent.innerHTML = legendHTML;
            architectureContent.innerHTML = architectureHTML;
        }

        // Mouse event handlers (same as before)
        getMousePos(e) {
            const rect = this.canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        getServiceAtPosition(x, y) {
            for (let service of this.services) {
                const dx = x - service.x;
                const dy = y - service.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance <= service.radius) {
                    return service;
                }
            }
            return null;
        }

        handleMouseDown(e) {
            const mousePos = this.getMousePos(e);
            const service = this.getServiceAtPosition(mousePos.x, mousePos.y);

            if (service) {
                this.isDragging = true;
                this.draggedService = service;
                this.lastMousePos = mousePos;
                this.canvasContainer.classList.add('dragging');
                this.hideTooltip();

                this.draggingIndicator.textContent = `Moving: ${service.name}`;
                this.draggingIndicator.style.display = 'block';
                this.draggingIndicator.style.left = mousePos.x + 10 + 'px';
                this.draggingIndicator.style.top = mousePos.y - 10 + 'px';
            }
        }

        handleMouseMove(e) {
            const mousePos = this.getMousePos(e);
            this.mousePos = mousePos;

            if (this.isDragging && this.draggedService) {
                const dx = mousePos.x - this.lastMousePos.x;
                const dy = mousePos.y - this.lastMousePos.y;

                this.draggedService.x += dx;
                this.draggedService.y += dy;

                const margin = this.draggedService.radius + 15;
                this.draggedService.x = Math.max(margin, Math.min(this.canvas.width / 2 - margin, this.draggedService.x));
                this.draggedService.y = Math.max(margin, Math.min(this.canvas.height / 2 - margin, this.draggedService.y));

                this.lastMousePos = mousePos;

                this.draggingIndicator.style.left = mousePos.x + 10 + 'px';
                this.draggingIndicator.style.top = mousePos.y - 10 + 'px';
            } else {
                const service = this.getServiceAtPosition(mousePos.x, mousePos.y);
                if (service) {
                    this.showTooltip(service, mousePos);
                } else {
                    this.hideTooltip();
                }
            }
        }

        handleMouseUp(e) {
            if (this.isDragging) {
                this.isDragging = false;
                this.draggedService = null;
                this.canvasContainer.classList.remove('dragging');
                this.draggingIndicator.style.display = 'none';
            }
        }

        handleMouseLeave(e) {
            this.hideTooltip();
            if (this.isDragging) {
                this.handleMouseUp(e);
            }
        }

        showTooltip(service, mousePos) {
            const tooltip = this.tooltip;
            const connections = this.communications.filter(c =>
                c.fromService === service || c.toService === service
            );

            const uptimeHours = ((Date.now() - service.launchTime) / (1000 * 60 * 60)).toFixed(1);

            tooltip.innerHTML = `
                <h4>${service.name}</h4>
                <div class="tooltip-section">
                    <div class="tooltip-label">AWS Service:</div>
                    <span class="aws-service-badge service-${service.awsService.toLowerCase()}">${service.awsService}</span>
                </div>
                <div class="tooltip-section">
                    <div class="tooltip-label">Instance Type:</div>
                    ${service.instanceType} (${service.vCPUs} vCPUs, ${service.memory} GB RAM)
                </div>
                <div class="tooltip-section">
                    <div class="tooltip-label">Performance:</div>
                    Utilization: ${service.utilization}%<br>
                    Throughput: ${service.throughput}<br>
                    Latency: ${service.latency}ms
                </div>
                <div class="tooltip-section">
                    <div class="tooltip-label">Reliability:</div>
                    Health: ${service.healthStatus}<br>
                    Uptime: ${uptimeHours}h<br>
                    SLA: ${service.slaTarget}%
                </div>
                <div class="tooltip-section">
                    <div class="tooltip-label">Cost:</div>
                    ${service.costPerHour}/hour<br>
                    Spot: ${service.isSpot ? 'Yes' : 'No'}
                </div>
                <div class="tooltip-section">
                    <div class="tooltip-label">Network:</div>
                    Active Connections: ${connections.length}<br>
                    AZ: ${service.availabilityZone}
                </div>
            `;

            tooltip.style.display = 'block';
            tooltip.style.left = Math.min(mousePos.x + 15, window.innerWidth - 340) + 'px';
            tooltip.style.top = Math.max(10, mousePos.y - 10) + 'px';
        }

        hideTooltip() {
            this.tooltip.style.display = 'none';
        }

        // Drawing methods (continue with existing drawing logic)
        drawService(service) {
            const { x, y, radius, gradient, activity, pulse, organelles, membrane } = service;

            // Dragging highlight
            if (this.draggedService === service) {
                this.ctx.strokeStyle = '#ffff00';
                this.ctx.lineWidth = 4;
                this.ctx.setLineDash([8, 4]);
                this.ctx.beginPath();
                this.ctx.arc(x, y, radius + 15, 0, Math.PI * 2);
                this.ctx.stroke();
                this.ctx.setLineDash([]);
            }

            // Service membrane with AWS-style glow
            const glowRadius = radius + 20 + Math.sin(pulse) * 8;
            const membraneGradient = this.ctx.createRadialGradient(x, y, radius * 0.7, x, y, glowRadius);
            membraneGradient.addColorStop(0, `${gradient[0]}50`);
            membraneGradient.addColorStop(0.7, `${gradient[0]}25`);
            membraneGradient.addColorStop(1, 'transparent');

            this.ctx.fillStyle = membraneGradient;
            this.ctx.fillRect(x - glowRadius, y - glowRadius, glowRadius * 2, glowRadius * 2);

            // Main service body
            const serviceGradient = this.ctx.createRadialGradient(x - radius * 0.4, y - radius * 0.4, 0, x, y, radius);
            serviceGradient.addColorStop(0, gradient[0] + 'DD');
            serviceGradient.addColorStop(0.6, gradient[1] + 'BB');
            serviceGradient.addColorStop(1, gradient[1] + '77');

            this.ctx.fillStyle = serviceGradient;
            this.ctx.beginPath();
            this.ctx.arc(x, y, radius, 0, Math.PI * 2);
            this.ctx.fill();

            // Service border with AWS styling
            this.ctx.strokeStyle = gradient[0] + 'EE';
            this.ctx.lineWidth = membrane.thickness;
            this.ctx.stroke();

            // Reliability indicator ring
            const reliabilityColor = service.reliabilityScore > 99 ? '#00ff88' :
                service.reliabilityScore > 95 ? '#ffa502' : '#ff4757';
            this.ctx.strokeStyle = reliabilityColor + '99';
            this.ctx.lineWidth = 3;
            this.ctx.beginPath();
            this.ctx.arc(x, y, radius + 10, 0, Math.PI * 2);
            this.ctx.stroke();

            // Internal components (organelles representing microservices/processes)
            organelles.forEach(org => {
                org.angle += org.speed * 0.008 * this.animationSpeed;
                const orgX = x + Math.cos(org.angle) * (radius * 0.4) + org.x * 0.4;
                const orgY = y + Math.sin(org.angle) * (radius * 0.4) + org.y * 0.4;

                this.ctx.fillStyle = org.color + '99';
                this.ctx.beginPath();
                this.ctx.arc(orgX, orgY, org.radius, 0, Math.PI * 2);
                this.ctx.fill();

                this.ctx.fillStyle = org.color + 'CC';
                this.ctx.beginPath();
                this.ctx.arc(orgX - 1, orgY - 1, org.radius * 0.7, 0, Math.PI * 2);
                this.ctx.fill();
            });

            // Central processing core
            const coreGradient = this.ctx.createRadialGradient(x, y, 0, x, y, 18);
            coreGradient.addColorStop(0, '#ffffff99');
            coreGradient.addColorStop(0.4, gradient[0] + '77');
            coreGradient.addColorStop(1, gradient[1] + '55');

            this.ctx.fillStyle = coreGradient;
            this.ctx.beginPath();
            this.ctx.arc(x, y, 18, 0, Math.PI * 2);
            this.ctx.fill();

            // Activity indicators
            if (activity > 0) {
                const activityRadius = radius + 25 + activity * 20;
                this.ctx.strokeStyle = gradient[0] + Math.floor(activity * 255).toString(16).padStart(2, '0');
                this.ctx.lineWidth = 4;
                this.ctx.beginPath();
                this.ctx.arc(x, y, activityRadius, 0, Math.PI * 2);
                this.ctx.stroke();
            }

            // AWS Service badge
            this.ctx.fillStyle = '#ff9500';
            this.ctx.font = 'bold 9px Arial';
            this.ctx.textAlign = 'center';
            this.ctx.fillText(service.awsService, x, y - radius - 45);

            // Service name and instance type
            this.ctx.fillStyle = '#ffffff';
            this.ctx.font = 'bold 11px Arial';
            this.ctx.fillText(service.name, x, y + radius + 18);

            this.ctx.fillStyle = '#a0a0a0';
            this.ctx.font = '8px Arial';
            this.ctx.fillText(service.instanceType, x, y + radius + 32);

            // Utilization bar
            const barWidth = 40;
            const barHeight = 4;
            const barX = x - barWidth / 2;
            const barY = y + radius + 40;

            this.ctx.fillStyle = '#333333';
            this.ctx.fillRect(barX, barY, barWidth, barHeight);

            const utilizationColor = service.utilization > 80 ? '#ff4757' :
                service.utilization > 60 ? '#ffa502' : '#00ff88';
            this.ctx.fillStyle = utilizationColor;
            this.ctx.fillRect(barX, barY, (barWidth * service.utilization) / 100, barHeight);

            // Status indicators
            const statusIcon = service.healthStatus === 'Healthy' ? 'üü¢' :
                service.healthStatus === 'Warning' ? 'üü°' : 'üî¥';
            this.ctx.font = '10px Arial';
            this.ctx.fillText(statusIcon, x + radius - 8, y - radius + 12);

            // Spot instance indicator
            if (service.isSpot) {
                this.ctx.fillStyle = '#ffa502';
                this.ctx.font = 'bold 8px Arial';
                this.ctx.fillText('SPOT', x - radius + 8, y - radius + 12);
            }

            // Cost indicator
            this.ctx.fillStyle = '#00ff88';
            this.ctx.font = '7px Arial';
            this.ctx.fillText(`${service.costPerHour}/h`, x, y + radius + 55);
        }

        // Communication drawing and management methods
        // Communication drawing and management methods
        // Communication drawing and management methods
        drawCommunication(comm) {
            const { fromService, toService, progress, type, particles, dataSize } = comm;

            if (!fromService || !toService) return;

            const dx = toService.x - fromService.x;
            const dy = toService.y - fromService.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            // Template-specific communication colors
            const protocolColors = this.getTemplateColors();
            const lineColor = protocolColors[type] || '#ffffff';
            const lineWidth = type === 'model-sync' ? 4 : type === 'data-transfer' ? 3 : 2;

            // Draw connection line
            this.ctx.strokeStyle = `${lineColor}${Math.floor((0.4 + Math.sin(progress * Math.PI) * 0.4) * 255).toString(16).padStart(2, '0')}`;
            this.ctx.lineWidth = lineWidth;

            if (type === 'monitoring') {
                this.ctx.setLineDash([5, 10]);
            } else if (type === 'checkpoint') {
                this.ctx.setLineDash([15, 5]);
            } else {
                this.ctx.setLineDash([]);
            }

            this.ctx.beginPath();
            this.ctx.moveTo(fromService.x, fromService.y);
            this.ctx.lineTo(toService.x, toService.y);
            this.ctx.stroke();
            this.ctx.setLineDash([]);

            // Enhanced directional arrow
            const arrowSize = 10;
            const arrowX = fromService.x + dx * 0.75;
            const arrowY = fromService.y + dy * 0.75;
            const angle = Math.atan2(dy, dx);

            this.ctx.fillStyle = lineColor;
            this.ctx.beginPath();
            this.ctx.moveTo(arrowX, arrowY);
            this.ctx.lineTo(
                arrowX - arrowSize * Math.cos(angle - Math.PI / 5),
                arrowY - arrowSize * Math.sin(angle - Math.PI / 5)
            );
            this.ctx.lineTo(
                arrowX - arrowSize * Math.cos(angle + Math.PI / 5),
                arrowY - arrowSize * Math.sin(angle + Math.PI / 5)
            );
            this.ctx.closePath();
            this.ctx.fill();

            // Draw communication type label
            const labelX = fromService.x + dx * 0.5;
            const labelY = fromService.y + dy * 0.5;

            // Create background for label
            const label = type.toUpperCase().replace('-', '_');
            this.ctx.font = 'bold 9px Arial';
            const labelMetrics = this.ctx.measureText(label);
            const labelWidth = labelMetrics.width + 8;
            const labelHeight = 16;

            // Label background
            this.ctx.fillStyle = 'rgba(0, 0, 0, 0.85)';
            this.ctx.fillRect(labelX - labelWidth/2, labelY - labelHeight/2, labelWidth, labelHeight);

            // Label border
            this.ctx.strokeStyle = lineColor + 'CC';
            this.ctx.lineWidth = 1;
            this.ctx.strokeRect(labelX - labelWidth/2, labelY - labelHeight/2, labelWidth, labelHeight);

            // Label text
            this.ctx.fillStyle = lineColor;
            this.ctx.textAlign = 'center';
            this.ctx.textBaseline = 'middle';
            this.ctx.fillText(label, labelX, labelY);

            // Data size indicator (smaller text below main label)
            if (dataSize) {
                this.ctx.font = '7px Arial';
                this.ctx.fillStyle = '#a0a0a0';
                this.ctx.fillText(dataSize, labelX, labelY + 12);
            }

            // Enhanced signal particles
            particles.forEach((particle, index) => {
                const particleProgress = (progress + index * 0.12) % 1;
                const particleX = fromService.x + dx * particleProgress;
                const particleY = fromService.y + dy * particleProgress;

                // Particle trail
                for (let i = 0; i < 5; i++) {
                    const trailProgress = Math.max(0, particleProgress - i * 0.06);
                    const trailX = fromService.x + dx * trailProgress;
                    const trailY = fromService.y + dy * trailProgress;
                    const alpha = (5 - i) / 5 * 0.9;

                    this.ctx.fillStyle = `${lineColor}${Math.floor(alpha * 255).toString(16).padStart(2, '0')}`;
                    this.ctx.beginPath();
                    this.ctx.arc(trailX, trailY, 5 - i * 0.8, 0, Math.PI * 2);
                    this.ctx.fill();
                }

                // Main particle with enhanced glow
                const particleGradient = this.ctx.createRadialGradient(particleX, particleY, 0, particleX, particleY, 12);
                particleGradient.addColorStop(0, lineColor);
                particleGradient.addColorStop(0.4, lineColor + 'BB');
                particleGradient.addColorStop(1, 'transparent');

                this.ctx.fillStyle = particleGradient;
                this.ctx.beginPath();
                this.ctx.arc(particleX, particleY, 12, 0, Math.PI * 2);
                this.ctx.fill();
            });

            // Communication protocol badge (for longer connections)
            if (distance > 200) {
                const badgeX = fromService.x + dx * 0.2;
                const badgeY = fromService.y + dy * 0.2;

                // Protocol indicator
                const protocolNames = {
                    'data-transfer': 'TCP',
                    'model-sync': 'gRPC',
                    'control-signal': 'HTTP',
                    'monitoring': 'UDP',
                    'checkpoint': 'S3 API',
                    'inference': 'REST',
                    'kubernetes': 'K8s API',
                    'batch-job': 'Batch API',
                    'federated': 'FL Proto',
                    'hybrid-sync': 'VPN',
                    'privacy-check': 'TLS'
                };

                const protocol = protocolNames[type] || 'TCP';
                this.ctx.font = '8px Arial';
                this.ctx.fillStyle = lineColor + 'AA';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(protocol, badgeX, badgeY - 8);
            }
        }

        getTemplateColors() {
            // Return communication colors based on current template
            const baseColors = {
                'data-transfer': '#00ff88',
                'model-sync': '#0080ff',
                'control-signal': '#ff9500',
                'checkpoint': '#9966cc',
                'monitoring': '#ff6b6b',
                'inference': '#00d4aa',
                'preprocessing': '#ffa502',
                'kubernetes': '#326ce5',
                'federated': '#e91e63',
                'batch-job': '#ff6b6b',
                'spark-task': '#4caf50',
                'container-deploy': '#ff8a65',
                'hpc-job': '#9c27b0',
                'hybrid-sync': '#607d8b',
                'privacy-check': '#e91e63'
            };
            return baseColors;
        }

        // Animation and update methods
        animate() {
            if (!this.isPaused) {
                // Clear canvas with template-specific background
                const gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width / 2, this.canvas.height / 2);
                gradient.addColorStop(0, '#0a0a0a');
                gradient.addColorStop(0.3, '#1a1a2e');
                gradient.addColorStop(0.7, '#16213e');
                gradient.addColorStop(1, '#2c1810');

                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width / 2, this.canvas.height / 2);

                // Update and draw services
                this.services.forEach(service => {
                    service.pulse += 0.04 * this.animationSpeed;
                    service.activity = Math.max(0, service.activity - 0.006);
                    service.radius = service.baseRadius + Math.sin(service.pulse) * 4;

                    this.drawService(service);
                });

                // Update and draw communications
                this.communications.forEach(comm => {
                    comm.progress += comm.speed * this.animationSpeed;
                    if (comm.progress >= 1) {
                        comm.progress = 0;
                        comm.toService.activity = Math.min(1, comm.toService.activity + 0.4);
                    }
                    this.drawCommunication(comm);
                });

                // Update training progress if training is active
                if (this.isTraining) {
                    this.trainingProgress += 0.1 * this.animationSpeed;
                    if (this.trainingProgress >= 100) {
                        this.trainingProgress = 100;
                        this.isTraining = false;
                        document.getElementById('trainingProgress').style.display = 'none';
                    }

                    const progressElement = document.getElementById('progressFill');
                    const progressText = document.getElementById('progressText');
                    if (progressElement && progressText) {
                        progressElement.style.width = this.trainingProgress + '%';
                        progressText.textContent = Math.round(this.trainingProgress) + '%';
                    }
                }
            }

            requestAnimationFrame(() => this.animate());
        }

        // Live console logging system
        logToConsole(message, type = 'info', serviceId = null) {
            if (!this.consoleVisible) return;

            const consoleLogs = document.getElementById('consoleLogs');
            if (!consoleLogs) return;

            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;

            let formattedMessage = message;
            if (serviceId) {
                const service = this.services.find(s => s.id === serviceId);
                if (service) {
                    formattedMessage = `[${service.name}] ${message}`;
                }
            }

            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span>${formattedMessage}</span>
            `;

            consoleLogs.appendChild(logEntry);

            // Limit console entries
            while (consoleLogs.children.length > this.maxConsoleEntries) {
                consoleLogs.removeChild(consoleLogs.firstChild);
            }

            // Auto-scroll to bottom
            consoleLogs.scrollTop = consoleLogs.scrollHeight;
        }

        // Enhanced communication adding with logging
        addCommunication(type, fromId = null, toId = null) {
            if (this.services.length < 2) return;

            let fromService, toService;

            if (fromId && toId) {
                fromService = this.services.find(s => s.id === fromId);
                toService = this.services.find(s => s.id === toId);
            } else {
                // Template-specific communication patterns
                const patterns = this.getCommunicationPatterns();
                const pattern = patterns[type];

                if (pattern) {
                    const fromIds = pattern.from.filter(id => this.services.find(s => s.id === id));
                    const toIds = pattern.to.filter(id => this.services.find(s => s.id === id));

                    if (fromIds.length > 0 && toIds.length > 0) {
                        fromService = this.services.find(s => s.id === fromIds[Math.floor(Math.random() * fromIds.length)]);
                        toService = this.services.find(s => s.id === toIds[Math.floor(Math.random() * toIds.length)]);
                    }
                }
            }

            if (!fromService || !toService || fromService === toService) {
                fromService = this.services[Math.floor(Math.random() * this.services.length)];
                toService = this.services[Math.floor(Math.random() * this.services.length)];
                if (fromService === toService) return;
            }

            const communication = {
                id: Date.now() + Math.random(),
                fromService,
                toService,
                type,
                progress: 0,
                speed: this.getCommunicationSpeed(type),
                particles: Array(this.getParticleCount(type)).fill().map((_, i) => ({ id: i })),
                startTime: Date.now(),
                dataSize: this.getDataSize(type)
            };

            this.communications.push(communication);

            // Log the communication
            const typeMessages = {
                'data-transfer': `üì§ Transferring ${communication.dataSize} to`,
                'model-sync': `üîÑ Synchronizing model weights with`,
                'control-signal': `üì° Sending control signals to`,
                'checkpoint': `üíæ Saving checkpoint to`,
                'monitoring': `üìä Sending metrics to`,
                'inference': `üß† Processing inference request to`,
                'preprocessing': `üîß Preprocessing data for`,
                'kubernetes': `‚ò∏Ô∏è Orchestrating pods on`,
                'batch-job': `üöÄ Submitting batch job to`,
                'spark-task': `‚ö° Distributing Spark task to`,
                'container-deploy': `üì¶ Deploying container to`,
                'hpc-job': `üî¨ Scheduling HPC job on`,
                'hybrid-sync': `üåê Cross-cloud sync with`,
                'federated': `ü§ù Federated learning update to`,
                'privacy-check': `üîí Privacy validation for`
            };

            const message = typeMessages[type] || `üì° Communication to`;
            this.logToConsole(`${message} ${toService.name}`, 'data', fromService.id);

            // Update service metrics
            fromService.activity = Math.min(1, fromService.activity + 0.5);
            toService.activity = Math.min(1, toService.activity + 0.4);
            fromService.utilization = Math.min(100, fromService.utilization + Math.random() * 5);

            // Log utilization changes
            if (fromService.utilization > 85) {
                this.logToConsole(`High utilization: ${Math.round(fromService.utilization)}%`, 'warning', fromService.id);
            }

            // Auto-remove after completion
            setTimeout(() => {
                this.communications = this.communications.filter(c => c.id !== communication.id);
                this.logToConsole(`‚úÖ ${type.toUpperCase()} completed`, 'success', toService.id);
            }, 8000);
        }

        // Initialize base costs for cost tracking
        initializeBaseCosts() {
            this.baseCosts = {};
            this.services.forEach(service => {
                this.baseCosts[service.id] = service.costPerHour;
            });
        }

        // Update cost tracker
        updateCostTracker() {
            const costBreakdown = document.getElementById('costBreakdown');
            if (!costBreakdown) return;

            let totalHourlyCost = 0;
            let totalMonthlyCost = 0;
            let spotSavings = 0;
            let scaleOutCost = 0;

            // Calculate costs
            this.services.forEach(service => {
                totalHourlyCost += service.costPerHour;
                if (service.isSpot) {
                    spotSavings += service.costPerHour * 0.7; // 70% savings
                }
            });

            // Calculate scale-out costs
            this.scaledInstances.forEach(instance => {
                scaleOutCost += instance.costPerHour;
            });

            totalMonthlyCost = totalHourlyCost * 24 * 30;
            const scaledMonthlyCost = scaleOutCost * 24 * 30;

            costBreakdown.innerHTML = `
                <div class="cost-row">
                    <span class="cost-label">Base Infrastructure:</span>
                    <span class="cost-value">$${Math.round(totalHourlyCost - scaleOutCost)}/hr</span>
                </div>
                <div class="cost-row">
                    <span class="cost-label">Scaled Instances:</span>
                    <span class="cost-value">$${Math.round(scaleOutCost)}/hr</span>
                </div>
                <div class="cost-row">
                    <span class="cost-label">Spot Savings:</span>
                    <span class="cost-value cost-savings">-$${Math.round(spotSavings)}/hr</span>
                </div>
                <div class="cost-row cost-total">
                    <span class="cost-label">Total Hourly:</span>
                    <span class="cost-value">$${Math.round(totalHourlyCost)}/hr</span>
                </div>
                <div class="cost-row">
                    <span class="cost-label">Monthly Projection:</span>
                    <span class="cost-value">$${Math.round(totalMonthlyCost).toLocaleString()}</span>
                </div>
                ${scaledMonthlyCost > 0 ? `
                <div class="cost-row">
                    <span class="cost-label">Scale-out Monthly:</span>
                    <span class="cost-value">+$${Math.round(scaledMonthlyCost).toLocaleString()}</span>
                </div>` : ''}
            `;
        }

        getCommunicationPatterns() {
            // Template-specific communication patterns
            const patterns = {
                'standard': {
                    'data-transfer': { from: ['S3_DATALAKE'], to: ['SAGEMAKER_TRAINING', 'EC2_TRAINING_NODES', 'LAMBDA_PREPROCESSING'] },
                    'model-sync': { from: ['SAGEMAKER_TRAINING', 'EC2_TRAINING_NODES'], to: ['ECS_SERVING', 'BEDROCK_MODELS'] },
                    'control-signal': { from: ['CLOUDWATCH_MONITORING'], to: ['SAGEMAKER_TRAINING', 'EC2_TRAINING_NODES'] },
                    'checkpoint': { from: ['SAGEMAKER_TRAINING', 'EC2_TRAINING_NODES'], to: ['S3_DATALAKE'] },
                    'monitoring': { from: ['SAGEMAKER_TRAINING', 'EC2_TRAINING_NODES', 'ECS_SERVING'], to: ['CLOUDWATCH_MONITORING'] },
                    'inference': { from: ['ECS_SERVING', 'BEDROCK_MODELS'], to: ['LAMBDA_PREPROCESSING'] },
                    'preprocessing': { from: ['LAMBDA_PREPROCESSING'], to: ['SAGEMAKER_TRAINING', 'EC2_TRAINING_NODES'] }
                },
                'eks-kubernetes': {
                    'kubernetes': { from: ['EKS_CONTROL_PLANE'], to: ['EKS_WORKER_GROUP_1', 'EKS_WORKER_GROUP_2'] },
                    'data-transfer': { from: ['EFS_STORAGE'], to: ['EKS_WORKER_GROUP_1', 'EKS_WORKER_GROUP_2'] },
                    'model-sync': { from: ['EKS_WORKER_GROUP_1', 'EKS_WORKER_GROUP_2'], to: ['ECR_REGISTRY'] },
                    'monitoring': { from: ['EKS_WORKER_GROUP_1', 'EKS_WORKER_GROUP_2'], to: ['EKS_CONTROL_PLANE'] },
                    'inference': { from: ['ALB_LOAD_BALANCER'], to: ['EKS_WORKER_GROUP_1', 'EKS_WORKER_GROUP_2'] }
                },
                'batch-hpc': {
                    'batch-job': { from: ['BATCH_JOB_QUEUE'], to: ['HPC_CLUSTER_1', 'HPC_CLUSTER_2'] },
                    'data-transfer': { from: ['FSX_LUSTRE'], to: ['HPC_CLUSTER_1', 'HPC_CLUSTER_2'] },
                    'control-signal': { from: ['BATCH_COMPUTE_ENV'], to: ['BATCH_JOB_QUEUE'] },
                    'monitoring': { from: ['HPC_CLUSTER_1', 'HPC_CLUSTER_2'], to: ['BATCH_COMPUTE_ENV'] }
                },
                'emr-spark': {
                    'spark-task': { from: ['EMR_MASTER'], to: ['SPARK_WORKERS', 'EMR_GPU_NODES'] },
                    'data-transfer': { from: ['HDFS_STORAGE'], to: ['SPARK_WORKERS', 'EMR_GPU_NODES'] },
                    'model-sync': { from: ['EMR_GPU_NODES'], to: ['HDFS_STORAGE'] },
                    'monitoring': { from: ['SPARK_WORKERS', 'EMR_GPU_NODES'], to: ['EMR_MASTER'] },
                    'preprocessing': { from: ['JUPYTER_HUB'], to: ['SPARK_WORKERS'] }
                },
                'fargate-serverless': {
                    'container-deploy': { from: ['FARGATE_SERVICE'], to: ['TRAINING_TASKS', 'DATA_PROCESSING_TASKS'] },
                    'data-transfer': { from: ['DATA_PROCESSING_TASKS'], to: ['TRAINING_TASKS'] },
                    'control-signal': { from: ['AUTO_SCALING_MANAGER'], to: ['TRAINING_TASKS', 'DATA_PROCESSING_TASKS'] },
                    'monitoring': { from: ['TRAINING_TASKS', 'DATA_PROCESSING_TASKS'], to: ['CLOUDWATCH_FARGATE'] },
                    'inference': { from: ['ALB_FARGATE'], to: ['TRAINING_TASKS'] }
                },
                'parallelcluster': {
                    'hpc-job': { from: ['SLURM_SCHEDULER'], to: ['GPU_COMPUTE_NODES', 'CPU_COMPUTE_NODES'] },
                    'data-transfer': { from: ['FSX_SHARED_STORAGE'], to: ['GPU_COMPUTE_NODES', 'CPU_COMPUTE_NODES'] },
                    'control-signal': { from: ['PARALLELCLUSTER_HEAD'], to: ['SLURM_SCHEDULER'] },
                    'monitoring': { from: ['GPU_COMPUTE_NODES', 'CPU_COMPUTE_NODES'], to: ['ENV_MANAGER'] }
                },
                'hybrid-multicloud': {
                    'hybrid-sync': { from: ['DIRECT_CONNECT'], to: ['ON_PREMISES_DC', 'AWS_OUTPOSTS'] },
                    'data-transfer': { from: ['ON_PREMISES_DC'], to: ['AWS_OUTPOSTS'] },
                    'model-sync': { from: ['MULTI_CLOUD_ORCHESTRATOR'], to: ['ON_PREMISES_DC', 'AWS_OUTPOSTS'] },
                    'inference': { from: ['EDGE_COMPUTING'], to: ['GLOBAL_LOAD_BALANCER'] },
                    'monitoring': { from: ['AWS_OUTPOSTS', 'EDGE_COMPUTING'], to: ['MULTI_CLOUD_ORCHESTRATOR'] }
                },
                'edge-federated': {
                    'federated': { from: ['FEDERATED_AGGREGATOR'], to: ['EDGE_CLUSTER_1', 'EDGE_CLUSTER_2'] },
                    'privacy-check': { from: ['PRIVACY_COORDINATOR'], to: ['EDGE_CLUSTER_1', 'EDGE_CLUSTER_2'] },
                    'model-sync': { from: ['EDGE_CLUSTER_1', 'EDGE_CLUSTER_2'], to: ['FEDERATED_AGGREGATOR'] },
                    'data-transfer': { from: ['DIFFERENTIAL_PRIVACY'], to: ['FEDERATED_AGGREGATOR'] },
                    'monitoring': { from: ['SECURE_COMM_HUB'], to: ['FEDERATED_AGGREGATOR'] }
                }
            };

            return patterns[this.currentTemplate] || patterns['standard'];
        }

        getCommunicationSpeed(type) {
            const speeds = {
                'data-transfer': 0.008,
                'model-sync': 0.006,
                'control-signal': 0.02,
                'checkpoint': 0.004,
                'monitoring': 0.015,
                'inference': 0.018,
                'preprocessing': 0.012,
                'kubernetes': 0.015,
                'federated': 0.005,
                'batch-job': 0.01,
                'spark-task': 0.012,
                'container-deploy': 0.014,
                'hpc-job': 0.008,
                'hybrid-sync': 0.006,
                'privacy-check': 0.02
            };
            return speeds[type] || 0.01;
        }

        getParticleCount(type) {
            const counts = {
                'data-transfer': 6,
                'model-sync': 8,
                'control-signal': 2,
                'checkpoint': 4,
                'monitoring': 3,
                'inference': 4,
                'preprocessing': 5,
                'kubernetes': 4,
                'federated': 3,
                'batch-job': 5,
                'spark-task': 6,
                'container-deploy': 4,
                'hpc-job': 7,
                'hybrid-sync': 5,
                'privacy-check': 2
            };
            return counts[type] || 3;
        }

        getDataSize(type) {
            const sizes = {
                'data-transfer': '2.3 GB',
                'model-sync': '850 MB',
                'control-signal': '15 KB',
                'checkpoint': '1.2 GB',
                'monitoring': '500 KB',
                'inference': '125 MB',
                'preprocessing': '450 MB',
                'kubernetes': '25 MB',
                'federated': '5 MB',
                'batch-job': '1.8 GB',
                'spark-task': '650 MB',
                'container-deploy': '200 MB',
                'hpc-job': '3.2 GB',
                'hybrid-sync': '900 MB',
                'privacy-check': '10 KB'
            };
            return sizes[type] || '100 MB';
        }

        // Floating particles for visual enhancement
        createFloatingParticles() {
            const particlesContainer = document.getElementById('particles');

            setInterval(() => {
                if (this.isPaused) return;

                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (10 + Math.random() * 6) + 's';
                particle.style.animationDelay = Math.random() * 3 + 's';

                particlesContainer.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, 16000);
            }, 4000);
        }

        // Metrics updating
        updateMetrics() {
            // Template-specific metrics adjustments
            const templateMultipliers = {
                'standard': { cost: 1.0, performance: 1.0 },
                'eks-kubernetes': { cost: 1.2, performance: 1.15 },
                'batch-hpc': { cost: 1.5, performance: 1.8 },
                'emr-spark': { cost: 1.3, performance: 1.4 },
                'fargate-serverless': { cost: 0.8, performance: 0.9 },
                'parallelcluster': { cost: 1.6, performance: 2.0 },
                'hybrid-multicloud': { cost: 1.4, performance: 1.1 },
                'edge-federated': { cost: 0.7, performance: 0.6 }
            };

            const multiplier = templateMultipliers[this.currentTemplate] || { cost: 1.0, performance: 1.0 };

            // Simulate realistic AWS metrics
            this.awsMetrics.gpuUtilization = Math.max(40, Math.min(95, this.awsMetrics.gpuUtilization + (Math.random() - 0.5) * 10));
            this.awsMetrics.trainingLoss = Math.max(1.2, this.awsMetrics.trainingLoss - Math.random() * 0.01);

            const activeServices = this.services.filter(s => s.activity > 0.1).length;
            this.awsMetrics.trainingInstances = activeServices;

            // Adjust throughput based on template
            const baseThroughput = 1200 * multiplier.performance;
            this.awsMetrics.throughput = `${(baseThroughput + Math.random() * 200).toFixed(0)} tokens/sec`;

            document.getElementById('trainingInstances').textContent = this.awsMetrics.trainingInstances;
            document.getElementById('gpuUtilization').textContent = Math.round(this.awsMetrics.gpuUtilization) + '%';
            document.getElementById('modelParams').textContent = this.awsMetrics.modelParams;
            document.getElementById('trainingLoss').textContent = this.awsMetrics.trainingLoss.toFixed(3);
            document.getElementById('throughput').textContent = this.awsMetrics.throughput;
            document.getElementById('dataProcessed').textContent = this.awsMetrics.dataProcessed;
            document.getElementById('networkIO').textContent = this.awsMetrics.networkIO;

            const avgReliability = this.services.reduce((sum, s) => sum + s.reliabilityScore, 0) / this.services.length;
            document.getElementById('reliabilityScore').textContent = avgReliability.toFixed(1) + '%';

            const totalCost = Math.round(this.services.reduce((sum, s) => sum + s.costPerHour, 0) * multiplier.cost);
            document.getElementById('costPerHour').textContent = '$' + totalCost;
        }

        startMetricsUpdater() {
            setInterval(() => {
                this.updateMetrics();
            }, 2000);
        }

        // Ripple effect for failures
        createRipple(x, y, color) {
            const ripple = {
                x, y, color,
                radius: 0,
                maxRadius: 150,
                opacity: 1,
                growing: true
            };

            const animateRipple = () => {
                if (ripple.growing) {
                    ripple.radius += 5;
                    ripple.opacity -= 0.02;

                    if (ripple.radius >= ripple.maxRadius || ripple.opacity <= 0) {
                        return;
                    }

                    this.drawRipple(ripple);
                    requestAnimationFrame(animateRipple);
                }
            };

            animateRipple();
        }

        drawRipple(ripple) {
            this.ctx.strokeStyle = `${ripple.color}${Math.floor(ripple.opacity * 255).toString(16).padStart(2, '0')}`;
            this.ctx.lineWidth = 4;
            this.ctx.beginPath();
            this.ctx.arc(ripple.x, ripple.y, ripple.radius, 0, Math.PI * 2);
            this.ctx.stroke();
        }


    }

    class DraggablePanelManager {
        constructor() {
            this.draggedElement = null;
            this.offset = { x: 0, y: 0 };
            this.isDragging = false;
            this.panels = [];

            this.initializeDraggablePanels();
            this.setupEventListeners();
        }

        initializeDraggablePanels() {
            // Define all draggable panels with their configurations
            const panelConfigs = [
                {
                    id: 'controls',
                    selector: '.controls',
                    title: 'Control Panel',
                    icon: 'üéõÔ∏è',
                    handleSelector: 'h4:first-child'
                },
                {
                    id: 'metricsPanel',
                    selector: '.metrics-panel',
                    title: 'System Metrics',
                    icon: 'üìä',
                    handleSelector: 'h3'
                },
                {
                    id: 'architectureDetails',
                    selector: '.architecture-details',
                    title: 'Architecture Details',
                    icon: 'üèóÔ∏è',
                    handleSelector: 'h3'
                },
                {
                    id: 'legend',
                    selector: '.legend',
                    title: 'Components Legend',
                    icon: 'üó∫Ô∏è',
                    handleSelector: 'h3'
                },
                {
                    id: 'liveConsole',
                    selector: '.live-console',
                    title: 'Live Console',
                    icon: 'üñ•Ô∏è',
                    handleSelector: '.console-header span'
                },
                {
                    id: 'costTracker',
                    selector: '.cost-tracker',
                    title: 'Cost Tracker',
                    icon: 'üí∞',
                    handleSelector: '.cost-header'
                },
                {
                    id: 'trainingProgress',
                    selector: '.training-progress',
                    title: 'Training Progress',
                    icon: 'üìà',
                    handleSelector: 'div:first-child'
                }
            ];

            panelConfigs.forEach(config => {
                const panel = document.querySelector(config.selector);
                if (panel) {
                    this.makePanelDraggable(panel, config);
                    this.panels.push({ element: panel, config });
                }
            });
        }

        makePanelDraggable(panel, config) {
            // Add draggable class
            panel.classList.add('draggable-panel');

            // Create or enhance the drag handle
            let dragHandle = panel.querySelector(config.handleSelector);
            if (dragHandle) {
                // Add drag handle styling
                dragHandle.classList.add('drag-handle');

                // Add icon if not already present
                if (!dragHandle.textContent.includes(config.icon)) {
                    dragHandle.innerHTML = `${config.icon} ${dragHandle.innerHTML}`;
                }
            } else {
                // Create a new drag handle if none exists
                dragHandle = document.createElement('div');
                dragHandle.className = 'drag-handle';
                dragHandle.innerHTML = `${config.icon} ${config.title}`;
                panel.insertBefore(dragHandle, panel.firstChild);
            }

            // Store original position for reset functionality
            const computedStyle = window.getComputedStyle(panel);
            panel.dataset.originalTop = computedStyle.top;
            panel.dataset.originalLeft = computedStyle.left;
            panel.dataset.originalRight = computedStyle.right;
            panel.dataset.originalBottom = computedStyle.bottom;

            // Add event listeners to the drag handle
            dragHandle.addEventListener('mousedown', (e) => this.startDrag(e, panel));
            dragHandle.addEventListener('touchstart', (e) => this.startDrag(e, panel), { passive: false });

            // Add double-click to minimize/restore
            dragHandle.addEventListener('dblclick', (e) => this.toggleMinimize(panel));

            // Add right-click context menu
            dragHandle.addEventListener('contextmenu', (e) => this.showContextMenu(e, panel, config));
        }

        startDrag(e, panel) {
            e.preventDefault();
            e.stopPropagation();

            this.isDragging = true;
            this.draggedElement = panel;

            // Handle both mouse and touch events
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);

            const rect = panel.getBoundingClientRect();
            this.offset.x = clientX - rect.left;
            this.offset.y = clientY - rect.top;

            // Add dragging visual feedback
            panel.classList.add('dragging');

            // Change panel to absolute positioning
            panel.style.position = 'absolute';
            panel.style.left = rect.left + 'px';
            panel.style.top = rect.top + 'px';
            panel.style.right = 'auto';
            panel.style.bottom = 'auto';

            // Create drag indicator
            this.createDragIndicator(panel);

            // Prevent text selection during drag
            document.body.style.userSelect = 'none';

            console.log(`üéØ Started dragging: ${panel.querySelector('.drag-handle').textContent}`);
        }

        setupEventListeners() {
            // Mouse events
            document.addEventListener('mousemove', (e) => this.onDrag(e));
            document.addEventListener('mouseup', (e) => this.endDrag(e));

            // Touch events
            document.addEventListener('touchmove', (e) => this.onDrag(e), { passive: false });
            document.addEventListener('touchend', (e) => this.endDrag(e));

            // Prevent default drag behavior on images and other elements
            document.addEventListener('dragstart', (e) => e.preventDefault());
        }

        onDrag(e) {
            if (!this.isDragging || !this.draggedElement) return;

            e.preventDefault();

            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);

            const newX = clientX - this.offset.x;
            const newY = clientY - this.offset.y;

            // Get viewport boundaries
            const maxX = window.innerWidth - this.draggedElement.offsetWidth;
            const maxY = window.innerHeight - this.draggedElement.offsetHeight;

            // Constrain to viewport
            const constrainedX = Math.max(0, Math.min(newX, maxX));
            const constrainedY = Math.max(0, Math.min(newY, maxY));

            this.draggedElement.style.left = constrainedX + 'px';
            this.draggedElement.style.top = constrainedY + 'px';

            // Update drag indicator
            this.updateDragIndicator(constrainedX, constrainedY);
        }

        endDrag(e) {
            if (!this.isDragging) return;

            this.isDragging = false;

            if (this.draggedElement) {
                this.draggedElement.classList.remove('dragging');

                // Snap to grid (optional)
                this.snapToGrid(this.draggedElement);

                console.log(`‚úÖ Finished dragging: ${this.draggedElement.querySelector('.drag-handle').textContent}`);
            }

            this.draggedElement = null;
            this.removeDragIndicator();

            // Restore text selection
            document.body.style.userSelect = '';
        }

        snapToGrid(element) {
            const gridSize = 20;
            const rect = element.getBoundingClientRect();

            const snappedX = Math.round(rect.left / gridSize) * gridSize;
            const snappedY = Math.round(rect.top / gridSize) * gridSize;

            element.style.left = snappedX + 'px';
            element.style.top = snappedY + 'px';
        }

        toggleMinimize(panel) {
            const content = panel.children;
            const isMinimized = panel.dataset.minimized === 'true';

            if (isMinimized) {
                // Restore
                for (let i = 1; i < content.length; i++) {
                    content[i].style.display = panel.dataset.originalDisplay || '';
                }
                panel.dataset.minimized = 'false';
                panel.style.height = panel.dataset.originalHeight || 'auto';
            } else {
                // Minimize
                panel.dataset.originalHeight = panel.style.height || 'auto';
                for (let i = 1; i < content.length; i++) {
                    panel.dataset.originalDisplay = content[i].style.display || '';
                    content[i].style.display = 'none';
                }
                panel.dataset.minimized = 'true';
                panel.style.height = 'auto';
            }
        }

        showContextMenu(e, panel, config) {
            e.preventDefault();

            // Remove existing context menu
            const existingMenu = document.querySelector('.panel-context-menu');
            if (existingMenu) existingMenu.remove();

            // Create context menu
            const menu = document.createElement('div');
            menu.className = 'panel-context-menu';
            menu.style.cssText = `
            position: fixed;
            left: ${e.clientX}px;
            top: ${e.clientY}px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #ff9500;
            border-radius: 8px;
            padding: 8px 0;
            z-index: 10000;
            min-width: 150px;
            font-size: 0.85rem;
        `;

            const menuItems = [
                { text: 'üìå Reset Position', action: () => this.resetPosition(panel) },
                { text: panel.dataset.minimized === 'true' ? 'üîº Restore' : 'üîΩ Minimize', action: () => this.toggleMinimize(panel) },
                { text: 'üëÅÔ∏è Toggle Visibility', action: () => this.toggleVisibility(panel) },
                { text: 'üìê Snap to Grid', action: () => this.snapToGrid(panel) }
            ];

            menuItems.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.textContent = item.text;
                menuItem.style.cssText = `
                padding: 8px 16px;
                cursor: pointer;
                color: white;
                transition: background 0.2s ease;
            `;
                menuItem.addEventListener('mouseenter', () => {
                    menuItem.style.background = 'rgba(255, 149, 0, 0.2)';
                });
                menuItem.addEventListener('mouseleave', () => {
                    menuItem.style.background = 'transparent';
                });
                menuItem.addEventListener('click', () => {
                    item.action();
                    menu.remove();
                });
                menu.appendChild(menuItem);
            });

            document.body.appendChild(menu);

            // Remove menu when clicking elsewhere
            setTimeout(() => {
                document.addEventListener('click', () => menu.remove(), { once: true });
            }, 100);
        }

        resetPosition(panel) {
            panel.style.position = '';
            panel.style.left = panel.dataset.originalLeft || '';
            panel.style.top = panel.dataset.originalTop || '';
            panel.style.right = panel.dataset.originalRight || '';
            panel.style.bottom = panel.dataset.originalBottom || '';

            console.log(`üîÑ Reset position for: ${panel.querySelector('.drag-handle').textContent}`);
        }

        toggleVisibility(panel) {
            const isHidden = panel.style.display === 'none';
            panel.style.display = isHidden ? '' : 'none';

            console.log(`üëÅÔ∏è ${isHidden ? 'Showed' : 'Hid'}: ${panel.querySelector('.drag-handle').textContent}`);
        }

        createDragIndicator(panel) {
            const indicator = document.createElement('div');
            indicator.id = 'panel-drag-indicator';
            indicator.style.cssText = `
            position: fixed;
            background: rgba(255, 149, 0, 0.8);
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            z-index: 10001;
            pointer-events: none;
            border: 1px solid rgba(255, 149, 0, 1);
            box-shadow: 0 4px 12px rgba(255, 149, 0, 0.4);
        `;
            indicator.textContent = `Moving: ${panel.querySelector('.drag-handle').textContent.replace(/[‚ãÆüéõÔ∏èüìäüèóÔ∏èüó∫Ô∏èüñ•Ô∏èüí∞üìà]/g, '').trim()}`;
            document.body.appendChild(indicator);
        }

        updateDragIndicator(x, y) {
            const indicator = document.getElementById('panel-drag-indicator');
            if (indicator) {
                indicator.style.left = (x + 10) + 'px';
                indicator.style.top = (y - 10) + 'px';
            }
        }

        removeDragIndicator() {
            const indicator = document.getElementById('panel-drag-indicator');
            if (indicator) indicator.remove();
        }

        // Utility method to reset all panels
        resetAllPanels() {
            this.panels.forEach(({ element }) => {
                this.resetPosition(element);
                element.style.display = '';
                if (element.dataset.minimized === 'true') {
                    this.toggleMinimize(element);
                }
            });
            console.log('üîÑ Reset all panels to original positions');
        }

        // Utility method to minimize all panels
        minimizeAllPanels() {
            this.panels.forEach(({ element }) => {
                if (element.dataset.minimized !== 'true') {
                    this.toggleMinimize(element);
                }
            });
            console.log('üîΩ Minimized all panels');
        }

        // Utility method to show all panels
        showAllPanels() {
            this.panels.forEach(({ element }) => {
                element.style.display = '';
                if (element.dataset.minimized === 'true') {
                    this.toggleMinimize(element);
                }
            });
            console.log('üëÅÔ∏è Showed all panels');
        }
    }

    // Global variable and initialization
    let awsArchitecture;
    // Initialize the draggable panel manager
    let panelManager;


    // Template change function
    function changeDeploymentTemplate() {
        const templateSelect = document.getElementById('deploymentTemplate');
        const selectedTemplate = templateSelect.value;

        if (awsArchitecture) {
            awsArchitecture.initializeDeploymentTemplate(selectedTemplate);
        }
    }

    function clearConsole() {
        const consoleLogs = document.getElementById('consoleLogs');
        if (consoleLogs) {
            consoleLogs.innerHTML = `
                <div class="log-entry log-system">
                    <span class="log-timestamp">[CLEAR]</span>
                    <span>Console cleared</span>
                </div>
            `;
        }
    }

    function toggleConsole() {
        const console = document.getElementById('liveConsole');
        const btn = event.target;

        if (console.style.display === 'none') {
            console.style.display = 'block';
            btn.textContent = 'Hide';
            if (awsArchitecture) {
                awsArchitecture.consoleVisible = true;
            }
        } else {
            console.style.display = 'none';
            btn.textContent = 'Show';
            if (awsArchitecture) {
                awsArchitecture.consoleVisible = false;
            }
        }
    }

    // Initialize AWS GenAI Architecture
    window.addEventListener('load', () => {
        awsArchitecture = new AWSGenAIArchitecture();

        // Auto-generate realistic communications based on template
        setInterval(() => {
            if (!awsArchitecture.isPaused && Math.random() < 0.6) {
                const template = awsArchitecture.currentTemplate;
                let communicationTypes = [];

                // Template-specific communication probabilities
                switch (template) {
                    case 'standard':
                        communicationTypes = [
                            { type: 'data-transfer', probability: 0.25 },
                            { type: 'model-sync', probability: 0.20 },
                            { type: 'monitoring', probability: 0.20 },
                            { type: 'control-signal', probability: 0.15 },
                            { type: 'inference', probability: 0.10 },
                            { type: 'preprocessing', probability: 0.10 }
                        ];
                        break;
                    case 'eks-kubernetes':
                        communicationTypes = [
                            { type: 'kubernetes', probability: 0.30 },
                            { type: 'data-transfer', probability: 0.25 },
                            { type: 'model-sync', probability: 0.20 },
                            { type: 'monitoring', probability: 0.15 },
                            { type: 'inference', probability: 0.10 }
                        ];
                        break;
                    case 'batch-hpc':
                        communicationTypes = [
                            { type: 'batch-job', probability: 0.35 },
                            { type: 'data-transfer', probability: 0.25 },
                            { type: 'control-signal', probability: 0.20 },
                            { type: 'monitoring', probability: 0.20 }
                        ];
                        break;
                    case 'emr-spark':
                        communicationTypes = [
                            { type: 'spark-task', probability: 0.30 },
                            { type: 'data-transfer', probability: 0.25 },
                            { type: 'model-sync', probability: 0.20 },
                            { type: 'monitoring', probability: 0.15 },
                            { type: 'preprocessing', probability: 0.10 }
                        ];
                        break;
                    case 'fargate-serverless':
                        communicationTypes = [
                            { type: 'container-deploy', probability: 0.30 },
                            { type: 'data-transfer', probability: 0.20 },
                            { type: 'control-signal', probability: 0.20 },
                            { type: 'monitoring', probability: 0.20 },
                            { type: 'inference', probability: 0.10 }
                        ];
                        break;
                    case 'parallelcluster':
                        communicationTypes = [
                            { type: 'hpc-job', probability: 0.35 },
                            { type: 'data-transfer', probability: 0.25 },
                            { type: 'control-signal', probability: 0.25 },
                            { type: 'monitoring', probability: 0.15 }
                        ];
                        break;
                    case 'hybrid-multicloud':
                        communicationTypes = [
                            { type: 'hybrid-sync', probability: 0.30 },
                            { type: 'data-transfer', probability: 0.25 },
                            { type: 'model-sync', probability: 0.20 },
                            { type: 'inference', probability: 0.15 },
                            { type: 'monitoring', probability: 0.10 }
                        ];
                        break;
                    case 'edge-federated':
                        communicationTypes = [
                            { type: 'federated', probability: 0.25 },
                            { type: 'privacy-check', probability: 0.25 },
                            { type: 'model-sync', probability: 0.20 },
                            { type: 'data-transfer', probability: 0.15 },
                            { type: 'monitoring', probability: 0.15 }
                        ];
                        break;
                    default:
                        communicationTypes = [
                            { type: 'data-transfer', probability: 0.25 },
                            { type: 'model-sync', probability: 0.20 },
                            { type: 'monitoring', probability: 0.20 },
                            { type: 'control-signal', probability: 0.15 },
                            { type: 'inference', probability: 0.10 },
                            { type: 'preprocessing', probability: 0.10 }
                        ];
                }

                const rand = Math.random();
                let cumulative = 0;

                for (const commType of communicationTypes) {
                    cumulative += commType.probability;
                    if (rand <= cumulative) {
                        awsArchitecture.addCommunication(commType.type);
                        break;
                    }
                }
            }
        }, 1800);

        // Periodic checkpoint saves during training
        setInterval(() => {
            if (awsArchitecture.isTraining && Math.random() < 0.3) {
                const template = awsArchitecture.currentTemplate;
                if (template === 'standard') {
                    awsArchitecture.addCommunication('checkpoint', 'SAGEMAKER_TRAINING', 'S3_DATALAKE');
                    awsArchitecture.addCommunication('checkpoint', 'EC2_TRAINING_NODES', 'S3_DATALAKE');
                } else if (template === 'eks-kubernetes') {
                    awsArchitecture.addCommunication('model-sync', 'EKS_WORKER_GROUP_1', 'ECR_REGISTRY');
                } else if (template === 'batch-hpc') {
                    awsArchitecture.addCommunication('data-transfer', 'HPC_CLUSTER_1', 'FSX_LUSTRE');
                }
            }
        }, 5000);

        // Initialize draggable panels after a short delay to ensure all elements are rendered
        setTimeout(() => {
            panelManager = new DraggablePanelManager();
            console.log('üéõÔ∏è Draggable panel manager initialized');
        }, 1000);
    });

    // Control Functions for Multi-Template Architecture

    function startTraining() {
        if (awsArchitecture) {
            awsArchitecture.isTraining = true;
            awsArchitecture.trainingProgress = 0;
            document.getElementById('trainingProgress').style.display = 'block';

            const template = awsArchitecture.currentTemplate;

            // Template-specific training initiation
            switch (template) {
                case 'standard':
                    awsArchitecture.addCommunication('data-transfer', 'S3_DATALAKE', 'SAGEMAKER_TRAINING');
                    awsArchitecture.addCommunication('data-transfer', 'S3_DATALAKE', 'EC2_TRAINING_NODES');
                    awsArchitecture.addCommunication('preprocessing', 'LAMBDA_PREPROCESSING', 'SAGEMAKER_TRAINING');

                    const trainingServices = ['SAGEMAKER_TRAINING', 'EC2_TRAINING_NODES'];
                    trainingServices.forEach(serviceId => {
                        const service = awsArchitecture.services.find(s => s.id === serviceId);
                        if (service) {
                            service.activity = 1;
                            service.utilization = Math.min(95, service.utilization + 20);
                        }
                    });
                    break;

                case 'eks-kubernetes':
                    awsArchitecture.addCommunication('kubernetes', 'EKS_CONTROL_PLANE', 'EKS_WORKER_GROUP_1');
                    awsArchitecture.addCommunication('kubernetes', 'EKS_CONTROL_PLANE', 'EKS_WORKER_GROUP_2');
                    awsArchitecture.addCommunication('data-transfer', 'EFS_STORAGE', 'EKS_WORKER_GROUP_1');

                    const k8sServices = ['EKS_WORKER_GROUP_1', 'EKS_WORKER_GROUP_2'];
                    k8sServices.forEach(serviceId => {
                        const service = awsArchitecture.services.find(s => s.id === serviceId);
                        if (service) {
                            service.activity = 1;
                            service.utilization = Math.min(95, service.utilization + 25);
                        }
                    });
                    break;

                case 'batch-hpc':
                    awsArchitecture.addCommunication('batch-job', 'BATCH_JOB_QUEUE', 'HPC_CLUSTER_1');
                    awsArchitecture.addCommunication('batch-job', 'BATCH_JOB_QUEUE', 'HPC_CLUSTER_2');
                    awsArchitecture.addCommunication('data-transfer', 'FSX_LUSTRE', 'HPC_CLUSTER_1');

                    const hpcServices = ['HPC_CLUSTER_1', 'HPC_CLUSTER_2'];
                    hpcServices.forEach(serviceId => {
                        const service = awsArchitecture.services.find(s => s.id === serviceId);
                        if (service) {
                            service.activity = 1;
                            service.utilization = Math.min(98, service.utilization + 30);
                        }
                    });
                    break;

                case 'emr-spark':
                    awsArchitecture.addCommunication('spark-task', 'EMR_MASTER', 'SPARK_WORKERS');
                    awsArchitecture.addCommunication('spark-task', 'EMR_MASTER', 'EMR_GPU_NODES');
                    awsArchitecture.addCommunication('data-transfer', 'HDFS_STORAGE', 'SPARK_WORKERS');

                    const sparkServices = ['SPARK_WORKERS', 'EMR_GPU_NODES'];
                    sparkServices.forEach(serviceId => {
                        const service = awsArchitecture.services.find(s => s.id === serviceId);
                        if (service) {
                            service.activity = 1;
                            service.utilization = Math.min(95, service.utilization + 22);
                        }
                    });
                    break;

                case 'fargate-serverless':
                    awsArchitecture.addCommunication('container-deploy', 'FARGATE_SERVICE', 'TRAINING_TASKS');
                    awsArchitecture.addCommunication('container-deploy', 'FARGATE_SERVICE', 'DATA_PROCESSING_TASKS');
                    awsArchitecture.addCommunication('data-transfer', 'DATA_PROCESSING_TASKS', 'TRAINING_TASKS');

                    const fargateServices = ['TRAINING_TASKS', 'DATA_PROCESSING_TASKS'];
                    fargateServices.forEach(serviceId => {
                        const service = awsArchitecture.services.find(s => s.id === serviceId);
                        if (service) {
                            service.activity = 1;
                            service.utilization = Math.min(90, service.utilization + 18);
                        }
                    });
                    break;

                case 'parallelcluster':
                    awsArchitecture.addCommunication('hpc-job', 'SLURM_SCHEDULER', 'GPU_COMPUTE_NODES');
                    awsArchitecture.addCommunication('hpc-job', 'SLURM_SCHEDULER', 'CPU_COMPUTE_NODES');
                    awsArchitecture.addCommunication('data-transfer', 'FSX_SHARED_STORAGE', 'GPU_COMPUTE_NODES');

                    const parallelServices = ['GPU_COMPUTE_NODES', 'CPU_COMPUTE_NODES'];
                    parallelServices.forEach(serviceId => {
                        const service = awsArchitecture.services.find(s => s.id === serviceId);
                        if (service) {
                            service.activity = 1;
                            service.utilization = Math.min(98, service.utilization + 25);
                        }
                    });
                    break;

                case 'hybrid-multicloud':
                    awsArchitecture.addCommunication('hybrid-sync', 'DIRECT_CONNECT', 'ON_PREMISES_DC');
                    awsArchitecture.addCommunication('hybrid-sync', 'DIRECT_CONNECT', 'AWS_OUTPOSTS');
                    awsArchitecture.addCommunication('model-sync', 'MULTI_CLOUD_ORCHESTRATOR', 'AWS_OUTPOSTS');

                    const hybridServices = ['ON_PREMISES_DC', 'AWS_OUTPOSTS', 'EDGE_COMPUTING'];
                    hybridServices.forEach(serviceId => {
                        const service = awsArchitecture.services.find(s => s.id === serviceId);
                        if (service) {
                            service.activity = 1;
                            service.utilization = Math.min(92, service.utilization + 20);
                        }
                    });
                    break;

                case 'edge-federated':
                    awsArchitecture.addCommunication('federated', 'FEDERATED_AGGREGATOR', 'EDGE_CLUSTER_1');
                    awsArchitecture.addCommunication('federated', 'FEDERATED_AGGREGATOR', 'EDGE_CLUSTER_2');
                    awsArchitecture.addCommunication('privacy-check', 'PRIVACY_COORDINATOR', 'EDGE_CLUSTER_1');

                    const federatedServices = ['EDGE_CLUSTER_1', 'EDGE_CLUSTER_2', 'FEDERATED_AGGREGATOR'];
                    federatedServices.forEach(serviceId => {
                        const service = awsArchitecture.services.find(s => s.id === serviceId);
                        if (service) {
                            service.activity = 1;
                            service.utilization = Math.min(85, service.utilization + 15);
                        }
                    });
                    break;
            }
        }
    }

    function pauseTraining() {
        if (awsArchitecture) {
            awsArchitecture.isTraining = false;
            const template = awsArchitecture.currentTemplate;

            // Template-specific pause actions
            switch (template) {
                case 'standard':
                    awsArchitecture.addCommunication('checkpoint', 'SAGEMAKER_TRAINING', 'S3_DATALAKE');
                    break;
                case 'eks-kubernetes':
                    awsArchitecture.addCommunication('model-sync', 'EKS_WORKER_GROUP_1', 'ECR_REGISTRY');
                    break;
                case 'batch-hpc':
                    awsArchitecture.addCommunication('data-transfer', 'HPC_CLUSTER_1', 'FSX_LUSTRE');
                    break;
                case 'emr-spark':
                    awsArchitecture.addCommunication('model-sync', 'EMR_GPU_NODES', 'HDFS_STORAGE');
                    break;
                case 'parallelcluster':
                    awsArchitecture.addCommunication('data-transfer', 'GPU_COMPUTE_NODES', 'FSX_SHARED_STORAGE');
                    break;
            }
        }
    }

    function stopTraining() {
        if (awsArchitecture) {
            awsArchitecture.isTraining = false;
            awsArchitecture.trainingProgress = 0;
            document.getElementById('trainingProgress').style.display = 'none';

            const template = awsArchitecture.currentTemplate;

            // Template-specific stop actions
            switch (template) {
                case 'standard':
                    awsArchitecture.addCommunication('model-sync', 'SAGEMAKER_TRAINING', 'S3_DATALAKE');
                    awsArchitecture.addCommunication('model-sync', 'EC2_TRAINING_NODES', 'BEDROCK_MODELS');
                    break;
                case 'eks-kubernetes':
                    awsArchitecture.addCommunication('model-sync', 'EKS_WORKER_GROUP_1', 'ECR_REGISTRY');
                    awsArchitecture.addCommunication('model-sync', 'EKS_WORKER_GROUP_2', 'ECR_REGISTRY');
                    break;
                case 'batch-hpc':
                    awsArchitecture.addCommunication('data-transfer', 'HPC_CLUSTER_1', 'FSX_LUSTRE');
                    awsArchitecture.addCommunication('data-transfer', 'HPC_CLUSTER_2', 'FSX_LUSTRE');
                    break;
                case 'emr-spark':
                    awsArchitecture.addCommunication('model-sync', 'EMR_GPU_NODES', 'HDFS_STORAGE');
                    awsArchitecture.addCommunication('model-sync', 'SPARK_WORKERS', 'HDFS_STORAGE');
                    break;
                case 'edge-federated':
                    awsArchitecture.addCommunication('model-sync', 'EDGE_CLUSTER_1', 'FEDERATED_AGGREGATOR');
                    awsArchitecture.addCommunication('model-sync', 'EDGE_CLUSTER_2', 'FEDERATED_AGGREGATOR');
                    break;
            }
        }
    }

    function triggerCheckpoint() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;

            switch (template) {
                case 'standard':
                    awsArchitecture.addCommunication('checkpoint', 'SAGEMAKER_TRAINING', 'S3_DATALAKE');
                    awsArchitecture.addCommunication('checkpoint', 'EC2_TRAINING_NODES', 'S3_DATALAKE');
                    break;
                case 'eks-kubernetes':
                    awsArchitecture.addCommunication('model-sync', 'EKS_WORKER_GROUP_1', 'ECR_REGISTRY');
                    awsArchitecture.addCommunication('model-sync', 'EKS_WORKER_GROUP_2', 'ECR_REGISTRY');
                    break;
                case 'batch-hpc':
                    awsArchitecture.addCommunication('data-transfer', 'HPC_CLUSTER_1', 'FSX_LUSTRE');
                    awsArchitecture.addCommunication('data-transfer', 'HPC_CLUSTER_2', 'FSX_LUSTRE');
                    break;
                case 'emr-spark':
                    awsArchitecture.addCommunication('model-sync', 'EMR_GPU_NODES', 'HDFS_STORAGE');
                    break;
                case 'parallelcluster':
                    awsArchitecture.addCommunication('data-transfer', 'GPU_COMPUTE_NODES', 'FSX_SHARED_STORAGE');
                    break;
                case 'edge-federated':
                    awsArchitecture.addCommunication('model-sync', 'EDGE_CLUSTER_1', 'FEDERATED_AGGREGATOR');
                    break;
            }

            setTimeout(() => {
                const locations = {
                    'standard': 's3://model-checkpoints/epoch-',
                    'eks-kubernetes': 'ecr://k8s-models/checkpoint-',
                    'batch-hpc': 'fsx://hpc-checkpoints/job-',
                    'emr-spark': 'hdfs://spark-models/epoch-',
                    'fargate-serverless': 'efs://serverless-models/task-',
                    'parallelcluster': 'lustre://cluster-checkpoints/slurm-',
                    'hybrid-multicloud': 'multi-cloud://global-models/sync-',
                    'edge-federated': 'federated://edge-models/round-'
                };

                const location = locations[template] || 's3://model-checkpoints/epoch-';
                alert(`‚úÖ Model checkpoint saved successfully!\nLocation: ${location}${Math.floor(Math.random() * 100)}`);
            }, 2000);
        }
    }

    function validateModel() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;

            switch (template) {
                case 'standard':
                    awsArchitecture.addCommunication('inference', 'ECS_SERVING', 'BEDROCK_MODELS');
                    awsArchitecture.addCommunication('data-transfer', 'S3_DATALAKE', 'ECS_SERVING');
                    break;
                case 'eks-kubernetes':
                    awsArchitecture.addCommunication('inference', 'ALB_LOAD_BALANCER', 'EKS_WORKER_GROUP_1');
                    break;
                case 'batch-hpc':
                    awsArchitecture.addCommunication('batch-job', 'BATCH_JOB_QUEUE', 'HPC_CLUSTER_1');
                    break;
                case 'emr-spark':
                    awsArchitecture.addCommunication('spark-task', 'EMR_MASTER', 'EMR_GPU_NODES');
                    break;
                case 'fargate-serverless':
                    awsArchitecture.addCommunication('inference', 'ALB_FARGATE', 'TRAINING_TASKS');
                    break;
                case 'edge-federated':
                    awsArchitecture.addCommunication('privacy-check', 'PRIVACY_COORDINATOR', 'EDGE_CLUSTER_1');
                    break;
            }

            setTimeout(() => {
                const accuracy = (92.5 + Math.random() * 5).toFixed(2);
                const f1Score = (0.89 + Math.random() * 0.08).toFixed(3);
                const templateMetrics = {
                    'standard': 'Perplexity',
                    'eks-kubernetes': 'Pod Efficiency',
                    'batch-hpc': 'Job Completion Rate',
                    'emr-spark': 'Partition Processing Rate',
                    'fargate-serverless': 'Container Startup Time',
                    'parallelcluster': 'Node Utilization',
                    'hybrid-multicloud': 'Cross-Cloud Latency',
                    'edge-federated': 'Privacy Budget'
                };

                const metricName = templateMetrics[template] || 'Perplexity';
                const metricValue = (15.2 + Math.random() * 5).toFixed(1);

                alert(`üéØ Model Validation Results:\nAccuracy: ${accuracy}%\nF1 Score: ${f1Score}\n${metricName}: ${metricValue}`);
            }, 3000);
        }
    }

    function triggerDataIngestion() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;

            switch (template) {
                case 'standard':
                    awsArchitecture.addCommunication('data-transfer', 'S3_DATALAKE', 'LAMBDA_PREPROCESSING');
                    awsArchitecture.addCommunication('preprocessing', 'LAMBDA_PREPROCESSING', 'SAGEMAKER_TRAINING');
                    break;
                case 'eks-kubernetes':
                    awsArchitecture.addCommunication('data-transfer', 'EFS_STORAGE', 'EKS_WORKER_GROUP_1');
                    break;
                case 'batch-hpc':
                    awsArchitecture.addCommunication('data-transfer', 'FSX_LUSTRE', 'HPC_CLUSTER_1');
                    break;
                case 'emr-spark':
                    awsArchitecture.addCommunication('data-transfer', 'HDFS_STORAGE', 'SPARK_WORKERS');
                    break;
                case 'fargate-serverless':
                    awsArchitecture.addCommunication('container-deploy', 'FARGATE_SERVICE', 'DATA_PROCESSING_TASKS');
                    break;
                case 'edge-federated':
                    awsArchitecture.addCommunication('data-transfer', 'DIFFERENTIAL_PRIVACY', 'FEDERATED_AGGREGATOR');
                    break;
            }

            const currentData = parseFloat(awsArchitecture.awsMetrics.dataProcessed);
            awsArchitecture.awsMetrics.dataProcessed = (currentData + 0.5 + Math.random() * 0.3).toFixed(1) + 'TB';
        }
    }

    function triggerPreprocessing() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;

            switch (template) {
                case 'standard':
                    awsArchitecture.addCommunication('preprocessing', 'LAMBDA_PREPROCESSING', 'SAGEMAKER_TRAINING');
                    awsArchitecture.addCommunication('preprocessing', 'LAMBDA_PREPROCESSING', 'EC2_TRAINING_NODES');
                    break;
                case 'emr-spark':
                    awsArchitecture.addCommunication('preprocessing', 'JUPYTER_HUB', 'SPARK_WORKERS');
                    break;
                case 'edge-federated':
                    awsArchitecture.addCommunication('privacy-check', 'DIFFERENTIAL_PRIVACY', 'EDGE_CLUSTER_1');
                    break;
            }
        }
    }

    function triggerDataValidation() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;

            switch (template) {
                case 'standard':
                    awsArchitecture.addCommunication('monitoring', 'S3_DATALAKE', 'CLOUDWATCH_MONITORING');
                    break;
                case 'eks-kubernetes':
                    awsArchitecture.addCommunication('monitoring', 'EKS_WORKER_GROUP_1', 'EKS_CONTROL_PLANE');
                    break;
                case 'batch-hpc':
                    awsArchitecture.addCommunication('monitoring', 'HPC_CLUSTER_1', 'BATCH_COMPUTE_ENV');
                    break;
                case 'fargate-serverless':
                    awsArchitecture.addCommunication('monitoring', 'TRAINING_TASKS', 'CLOUDWATCH_FARGATE');
                    break;
                case 'edge-federated':
                    awsArchitecture.addCommunication('privacy-check', 'PRIVACY_COORDINATOR', 'EDGE_CLUSTER_1');
                    break;
            }

            setTimeout(() => {
                const dataQuality = (96.8 + Math.random() * 2.5).toFixed(1);
                const templateMessages = {
                    'standard': 'Schema Compliance: 99.7%',
                    'eks-kubernetes': 'Pod Readiness: 98.5%',
                    'batch-hpc': 'Job Queue Health: 99.1%',
                    'emr-spark': 'Partition Balance: 97.8%',
                    'fargate-serverless': 'Task Health: 99.3%',
                    'parallelcluster': 'Node Availability: 98.9%',
                    'hybrid-multicloud': 'Cross-Cloud Sync: 96.4%',
                    'edge-federated': 'Privacy Compliance: 100%'
                };

                const templateMessage = templateMessages[template] || 'Schema Compliance: 99.7%';
                alert(`üìä Data Validation Complete:\nData Quality Score: ${dataQuality}%\nCorrupted Records: ${Math.floor(Math.random() * 50)}\n${templateMessage}`);
            }, 2500);
        }
    }

    function updateInstanceType() {
        if (awsArchitecture) {
            const instanceType = document.getElementById('instanceType').value;
            const template = awsArchitecture.currentTemplate;

            // Update instance types based on template
            let targetServices = [];
            switch (template) {
                case 'standard':
                    targetServices = ['EC2_TRAINING_NODES'];
                    break;
                case 'eks-kubernetes':
                    targetServices = ['EKS_WORKER_GROUP_1', 'EKS_WORKER_GROUP_2'];
                    break;
                case 'batch-hpc':
                    targetServices = ['HPC_CLUSTER_1', 'HPC_CLUSTER_2'];
                    break;
                case 'emr-spark':
                    targetServices = ['SPARK_WORKERS', 'EMR_GPU_NODES'];
                    break;
                case 'parallelcluster':
                    targetServices = ['GPU_COMPUTE_NODES', 'CPU_COMPUTE_NODES'];
                    break;
            }

            targetServices.forEach(serviceId => {
                const service = awsArchitecture.services.find(s => s.id === serviceId);
                if (service) {
                    service.instanceType = instanceType;
                    const costs = {
                        'p4d.24xlarge': 434,
                        'p3dn.24xlarge': 318,
                        'trn1.32xlarge': 245,
                        'inf2.48xlarge': 156
                    };
                    service.costPerHour = costs[instanceType] || 400;
                }
            });
        }
    }

    function scaleOut() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;
            const centerX = awsArchitecture.canvas.width / 4;
            const centerY = awsArchitecture.canvas.height / 4;

            let newInstance;
            switch (template) {
                case 'standard':
                    newInstance = {
                        id: `EC2_SCALE_${Date.now()}`,
                        name: 'EC2 Scale Instance',
                        x: 200 + Math.random() * 400,
                        y: 200 + Math.random() * 300,
                        radius: 45,
                        baseRadius: 45,
                        color: '#ff9500',
                        gradient: ['#ff9500', '#ff6b35'],
                        activity: 0,
                        pulse: 0,
                        awsService: 'EC2',
                        instanceType: document.getElementById('instanceType').value,
                        vCPUs: 96,
                        memory: 1152,
                        utilization: 45,
                        throughput: '750 tokens/sec',
                        latency: 42,
                        healthStatus: 'Healthy',
                        launchTime: Date.now(),
                        slaTarget: 99.0,
                        costPerHour: 434,
                        isSpot: true,
                        availabilityZone: 'us-east-1c',
                        organelles: awsArchitecture.createOrganelles(8),
                        membrane: { thickness: 3, opacity: 0.85 },
                        reliabilityScore: 98.5
                    };
                    break;

                case 'eks-kubernetes':
                    newInstance = {
                        id: `K8S_NODE_${Date.now()}`,
                        name: 'K8s Worker Node',
                        x: centerX + 100 + Math.random() * 200,
                        y: centerY + Math.random() * 200,
                        radius: 50,
                        baseRadius: 50,
                        color: '#326ce5',
                        gradient: ['#326ce5', '#1565c0'],
                        activity: 0,
                        pulse: 0,
                        awsService: 'EKS',
                        instanceType: 'c5.4xlarge',
                        vCPUs: 16,
                        memory: 32,
                        utilization: 35,
                        throughput: '580 tokens/sec',
                        latency: 28,
                        healthStatus: 'Healthy',
                        launchTime: Date.now(),
                        slaTarget: 99.0,
                        costPerHour: 185,
                        isSpot: true,
                        availabilityZone: 'us-east-1c',
                        organelles: awsArchitecture.createOrganelles(6),
                        membrane: { thickness: 3, opacity: 0.85 },
                        reliabilityScore: 98.2
                    };
                    break;

                case 'batch-hpc':
                    newInstance = {
                        id: `HPC_NODE_${Date.now()}`,
                        name: 'HPC Compute Node',
                        x: centerX + Math.random() * 300,
                        y: centerY + 100 + Math.random() * 150,
                        radius: 55,
                        baseRadius: 55,
                        color: '#ff6b6b',
                        gradient: ['#ff6b6b', '#ff4757'],
                        activity: 0,
                        pulse: 0,
                        awsService: 'Batch',
                        instanceType: 'c5n.18xlarge',
                        vCPUs: 72,
                        memory: 144,
                        utilization: 65,
                        throughput: '1.1k jobs/sec',
                        latency: 22,
                        healthStatus: 'Healthy',
                        launchTime: Date.now(),
                        slaTarget: 98.5,
                        costPerHour: 325,
                        isSpot: true,
                        availabilityZone: 'us-east-1d',
                        organelles: awsArchitecture.createOrganelles(8),
                        membrane: { thickness: 4, opacity: 0.9 },
                        reliabilityScore: 98.0
                    };
                    break;
            }

            if (newInstance) {
                awsArchitecture.services.push(newInstance);  // ‚Üê Fixed: use awsArchitecture instead of this
                awsArchitecture.scaledInstances.push(newInstance);  // ‚Üê Fixed: use awsArchitecture instead of this

                // Log the scale out
                awsArchitecture.logToConsole(`üìà Scaling out: ${newInstance.name} launched`, 'success');  // ‚Üê Fixed
                awsArchitecture.logToConsole(`üí∞ Additional cost: $${newInstance.costPerHour}/hour`, 'info');  // ‚Üê Fixed

                // Update cost tracker
                awsArchitecture.updateCostTracker();  // ‚Üê Fixed

                alert(`üìà New ${template} instance launched!\nInstance: ${newInstance.name}\nCost: $${newInstance.costPerHour}/hour`);
            }
        }
    }


    function scaleIn() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;
            let scaleInstance;

            switch (template) {
                case 'standard':
                    scaleInstance = awsArchitecture.services.find(s => s.id.startsWith('EC2_SCALE_'));
                    break;
                case 'eks-kubernetes':
                    scaleInstance = awsArchitecture.services.find(s => s.id.startsWith('K8S_NODE_'));
                    break;
                case 'batch-hpc':
                    scaleInstance = awsArchitecture.services.find(s => s.id.startsWith('HPC_NODE_'));
                    break;
            }

            if (scaleInstance) {
                const costSavings = scaleInstance.costPerHour;

                awsArchitecture.services = awsArchitecture.services.filter(s => s !== scaleInstance);  // ‚Üê Fixed
                awsArchitecture.scaledInstances = awsArchitecture.scaledInstances.filter(s => s !== scaleInstance);  // ‚Üê Fixed

                // Log the scale in
                awsArchitecture.logToConsole(`üìâ Scaling in: ${scaleInstance.name} terminated`, 'info');  // ‚Üê Fixed
                awsArchitecture.logToConsole(`üí∞ Cost savings: $${costSavings}/hour`, 'success');  // ‚Üê Fixed

                // Update cost tracker
                awsArchitecture.updateCostTracker();  // ‚Üê Fixed

                alert(`üìâ Instance terminated gracefully\nCost savings: $${costSavings}/hour`);
            } else {
                awsArchitecture.logToConsole('‚ö†Ô∏è No scalable instances found to terminate', 'warning');  // ‚Üê Fixed
                alert('No scalable instances found to terminate.');
            }
        }
    }

    function addSpotInstance() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;
            const centerX = awsArchitecture.canvas.width / 4;
            const centerY = awsArchitecture.canvas.height / 4;

            const spotInstance = {
                id: `SPOT_${Date.now()}`,
                name: `${template.toUpperCase()} Spot Instance`,
                x: 300 + Math.random() * 200,
                y: 150 + Math.random() * 200,
                radius: 40,
                baseRadius: 40,
                color: '#ffa502',
                gradient: ['#ffa502', '#ff6b35'],
                activity: 0,
                pulse: 0,
                awsService: template === 'eks-kubernetes' ? 'EKS' : 'EC2',
                instanceType: 'p3.8xlarge',
                vCPUs: 32,
                memory: 244,
                utilization: 65,
                throughput: '420 tokens/sec',
                latency: 35,
                healthStatus: 'Healthy',
                launchTime: Date.now(),
                slaTarget: 95.0,
                costPerHour: 89,
                isSpot: true,
                availabilityZone: 'us-east-1d',
                organelles: awsArchitecture.createOrganelles(6),
                membrane: { thickness: 2, opacity: 0.8 },
                reliabilityScore: 96.5
            };

            awsArchitecture.services.push(spotInstance);
            alert('üí∞ Spot instance launched!\n70% cost savings: $89/hour vs $298/hour');
        }
    }

    function simulateFailure() {
        if (awsArchitecture && awsArchitecture.services.length > 0) {
            const targetService = awsArchitecture.services[Math.floor(Math.random() * awsArchitecture.services.length)];
            targetService.healthStatus = 'Critical';
            targetService.reliabilityScore = Math.max(80, targetService.reliabilityScore - 15);
            targetService.utilization = 0;

            awsArchitecture.createRipple(targetService.x, targetService.y, '#ff0000');

            const template = awsArchitecture.currentTemplate;
            const failureMessages = {
                'standard': 'EC2 instance failure detected',
                'eks-kubernetes': 'Kubernetes pod crashed',
                'batch-hpc': 'HPC job failed',
                'emr-spark': 'Spark executor failure',
                'fargate-serverless': 'Container task stopped',
                'parallelcluster': 'Compute node down',
                'hybrid-multicloud': 'Cross-cloud link failure',
                'edge-federated': 'Edge device disconnected'
            };

            const message = failureMessages[template] || 'Service failure detected';
            alert(`üö® CRITICAL FAILURE DETECTED!\n${message}: ${targetService.name}\nAuto-failover initiated...\nEstimated recovery: 2-3 minutes`);

            setTimeout(() => {
                targetService.healthStatus = 'Healthy';
                targetService.reliabilityScore = Math.min(99.5, targetService.reliabilityScore + 10);
                targetService.utilization = 45 + Math.random() * 30;
                alert(`‚úÖ Service ${targetService.name} recovered successfully!`);
            }, 10000);
        }
    }

    function triggerFailover() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;

            switch (template) {
                case 'standard':
                    awsArchitecture.addCommunication('model-sync', 'SAGEMAKER_TRAINING', 'ECS_SERVING');
                    break;
                case 'eks-kubernetes':
                    awsArchitecture.addCommunication('kubernetes', 'EKS_CONTROL_PLANE', 'EKS_WORKER_GROUP_2');
                    break;
                case 'hybrid-multicloud':
                    awsArchitecture.addCommunication('hybrid-sync', 'MULTI_CLOUD_ORCHESTRATOR', 'AWS_OUTPOSTS');
                    break;
            }

            const failoverMessages = {
                'standard': 'Failover to us-west-2 initiated',
                'eks-kubernetes': 'Pod rescheduling across nodes',
                'batch-hpc': 'Job migration to healthy nodes',
                'emr-spark': 'Task redistribution in progress',
                'fargate-serverless': 'Container auto-restart initiated',
                'parallelcluster': 'Slurm job requeue activated',
                'hybrid-multicloud': 'Multi-cloud failover triggered',
                'edge-federated': 'Federated learning resumption'
            };

            const message = failoverMessages[template] || 'Failover initiated';
            alert(`üîÑ ${message}\nTraffic rerouting in progress...\nRTO: <60 seconds, RPO: <30 seconds`);
        }
    }

    function runHealthCheck() {
        if (awsArchitecture) {
            awsArchitecture.services.forEach(service => {
                awsArchitecture.addCommunication('monitoring', service.id,
                    awsArchitecture.currentTemplate === 'standard' ? 'CLOUDWATCH_MONITORING' :
                        awsArchitecture.currentTemplate === 'fargate-serverless' ? 'CLOUDWATCH_FARGATE' :
                            'EKS_CONTROL_PLANE');
            });

            setTimeout(() => {
                const healthyServices = awsArchitecture.services.filter(s => s.healthStatus === 'Healthy').length;
                const totalServices = awsArchitecture.services.length;
                const overallHealth = (healthyServices / totalServices * 100).toFixed(1);

                const template = awsArchitecture.currentTemplate;
                const healthMessages = {
                    'standard': 'All AWS services operational',
                    'eks-kubernetes': 'All Kubernetes nodes ready',
                    'batch-hpc': 'All HPC clusters available',
                    'emr-spark': 'All Spark workers healthy',
                    'fargate-serverless': 'All containers running',
                    'parallelcluster': 'All compute nodes online',
                    'hybrid-multicloud': 'All cloud connections stable',
                    'edge-federated': 'All edge devices connected'
                };

                const message = healthMessages[template] || 'All systems operational';
                alert(`‚ù§Ô∏è HEALTH CHECK REPORT:\nHealthy Services: ${healthyServices}/${totalServices}\nOverall Health: ${overallHealth}%\n${message}`);
            }, 3000);
        }
    }

    function updateSpeed(value) {
        if (awsArchitecture) {
            awsArchitecture.animationSpeed = parseFloat(value);
            document.getElementById('speedValue').textContent = `${value}x`;
        }
    }

    function clearCommunications() {
        if (awsArchitecture) {
            awsArchitecture.communications = [];
        }
    }

    function togglePause() {
        if (awsArchitecture) {
            awsArchitecture.isPaused = !awsArchitecture.isPaused;
            const button = event.target;
            button.textContent = awsArchitecture.isPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
        }
    }

    function resetArchitecture() {
        if (awsArchitecture) {
            const currentTemplate = awsArchitecture.currentTemplate;
            awsArchitecture.services = [];
            awsArchitecture.communications = [];
            awsArchitecture.isTraining = false;
            awsArchitecture.trainingProgress = 0;
            document.getElementById('trainingProgress').style.display = 'none';

            // Reset metrics to template-specific defaults
            const templateDefaults = {
                'standard': {
                    trainingInstances: 4,
                    gpuUtilization: 78,
                    modelParams: '70B',
                    trainingLoss: 2.34,
                    throughput: '1.2k tokens/sec',
                    dataProcessed: '2.3TB',
                    networkIO: '450 MB/s',
                    reliabilityScore: 99.2,
                    costPerHour: 892
                },
                'eks-kubernetes': {
                    trainingInstances: 6,
                    gpuUtilization: 82,
                    modelParams: '70B',
                    trainingLoss: 2.28,
                    throughput: '1.4k tokens/sec',
                    dataProcessed: '2.8TB',
                    networkIO: '520 MB/s',
                    reliabilityScore: 99.0,
                    costPerHour: 1065
                },
                'batch-hpc': {
                    trainingInstances: 8,
                    gpuUtilization: 95,
                    modelParams: '175B',
                    trainingLoss: 2.15,
                    throughput: '2.2k tokens/sec',
                    dataProcessed: '5.5TB',
                    networkIO: '850 MB/s',
                    reliabilityScore: 98.5,
                    costPerHour: 1650
                },
                'emr-spark': {
                    trainingInstances: 12,
                    gpuUtilization: 88,
                    modelParams: '70B',
                    trainingLoss: 2.22,
                    throughput: '1.8k tokens/sec',
                    dataProcessed: '4.2TB',
                    networkIO: '680 MB/s',
                    reliabilityScore: 98.8,
                    costPerHour: 1285
                },
                'fargate-serverless': {
                    trainingInstances: 0, // Auto-scaling
                    gpuUtilization: 65,
                    modelParams: '30B',
                    trainingLoss: 2.45,
                    throughput: '950 tokens/sec',
                    dataProcessed: '1.8TB',
                    networkIO: '320 MB/s',
                    reliabilityScore: 99.5,
                    costPerHour: 685
                },
                'parallelcluster': {
                    trainingInstances: 16,
                    gpuUtilization: 97,
                    modelParams: '500B',
                    trainingLoss: 1.98,
                    throughput: '3.5k tokens/sec',
                    dataProcessed: '12.5TB',
                    networkIO: '1.2 GB/s',
                    reliabilityScore: 98.2,
                    costPerHour: 2450
                },
                'hybrid-multicloud': {
                    trainingInstances: 10,
                    gpuUtilization: 75,
                    modelParams: '70B',
                    trainingLoss: 2.38,
                    throughput: '1.1k tokens/sec',
                    dataProcessed: '3.2TB',
                    networkIO: '580 MB/s',
                    reliabilityScore: 97.8,
                    costPerHour: 1285
                },
                'edge-federated': {
                    trainingInstances: 50, // Edge devices
                    gpuUtilization: 45,
                    modelParams: '7B',
                    trainingLoss: 2.85,
                    throughput: '380 tokens/sec',
                    dataProcessed: '850GB',
                    networkIO: '125 MB/s',
                    reliabilityScore: 96.5,
                    costPerHour: 485
                }
            };

            awsArchitecture.awsMetrics = templateDefaults[currentTemplate] || templateDefaults['standard'];
            awsArchitecture.initializeDeploymentTemplate(currentTemplate);
        }
    }

    // Template-specific utility functions
    function getTemplateSpecificAlerts(template, alertType) {
        const alerts = {
            'standard': {
                'scaling': 'EC2 Auto Scaling Group scaled out',
                'cost': 'Monthly cost projection: $19,500',
                'performance': 'SageMaker training job completed'
            },
            'eks-kubernetes': {
                'scaling': 'Kubernetes HPA scaled pods',
                'cost': 'Monthly cost projection: $23,200',
                'performance': 'All pods running successfully'
            },
            'batch-hpc': {
                'scaling': 'Batch compute environment expanded',
                'cost': 'Monthly cost projection: $35,800',
                'performance': 'HPC job queue processing optimally'
            },
            'emr-spark': {
                'scaling': 'EMR cluster auto-scaled',
                'cost': 'Monthly cost projection: $28,500',
                'performance': 'Spark job execution completed'
            },
            'fargate-serverless': {
                'scaling': 'Fargate tasks auto-scaled',
                'cost': 'Monthly cost projection: $14,200',
                'performance': 'Serverless execution optimal'
            },
            'parallelcluster': {
                'scaling': 'Slurm nodes added to partition',
                'cost': 'Monthly cost projection: $52,500',
                'performance': 'HPC workload distribution efficient'
            },
            'hybrid-multicloud': {
                'scaling': 'Multi-cloud resources balanced',
                'cost': 'Monthly cost projection: $31,800',
                'performance': 'Cross-cloud synchronization stable'
            },
            'edge-federated': {
                'scaling': 'Edge devices joined federation',
                'cost': 'Monthly cost projection: $8,500',
                'performance': 'Federated learning round completed'
            }
        };

        return alerts[template] && alerts[template][alertType] || 'Operation completed successfully';
    }

    // Advanced template-specific operations
    function triggerTemplateSpecificOperation() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;

            switch (template) {
                case 'eks-kubernetes':
                    // Trigger pod autoscaling
                    awsArchitecture.addCommunication('kubernetes', 'EKS_CONTROL_PLANE', 'EKS_WORKER_GROUP_1');
                    awsArchitecture.addCommunication('kubernetes', 'EKS_CONTROL_PLANE', 'EKS_WORKER_GROUP_2');
                    alert('üéØ Kubernetes HPA triggered\nScaling pods based on CPU utilization\nTarget: 70% CPU utilization');
                    break;

                case 'batch-hpc':
                    // Trigger batch job submission
                    awsArchitecture.addCommunication('batch-job', 'BATCH_JOB_QUEUE', 'HPC_CLUSTER_1');
                    awsArchitecture.addCommunication('batch-job', 'BATCH_JOB_QUEUE', 'HPC_CLUSTER_2');
                    alert('üöÄ Batch job array submitted\n1000 parallel training jobs\nEstimated completion: 6 hours');
                    break;

                case 'emr-spark':
                    // Trigger Spark job optimization
                    awsArchitecture.addCommunication('spark-task', 'EMR_MASTER', 'SPARK_WORKERS');
                    awsArchitecture.addCommunication('spark-task', 'EMR_MASTER', 'EMR_GPU_NODES');
                    alert('‚ö° Spark job optimization triggered\nDynamic partition rebalancing\nMemory optimization enabled');
                    break;

                case 'fargate-serverless':
                    // Trigger serverless scaling
                    awsArchitecture.addCommunication('container-deploy', 'AUTO_SCALING_MANAGER', 'TRAINING_TASKS');
                    awsArchitecture.addCommunication('container-deploy', 'AUTO_SCALING_MANAGER', 'DATA_PROCESSING_TASKS');
                    alert('üìà Serverless auto-scaling triggered\nZero to production in 30 seconds\nPay-per-use pricing active');
                    break;

                case 'parallelcluster':
                    // Trigger HPC job scheduling
                    awsArchitecture.addCommunication('hpc-job', 'SLURM_SCHEDULER', 'GPU_COMPUTE_NODES');
                    awsArchitecture.addCommunication('hpc-job', 'SLURM_SCHEDULER', 'CPU_COMPUTE_NODES');
                    alert('üî¨ HPC job scheduled via Slurm\nMulti-node MPI training\n512 GPU cluster allocation');
                    break;

                case 'hybrid-multicloud':
                    // Trigger cross-cloud synchronization
                    awsArchitecture.addCommunication('hybrid-sync', 'MULTI_CLOUD_ORCHESTRATOR', 'ON_PREMISES_DC');
                    awsArchitecture.addCommunication('hybrid-sync', 'MULTI_CLOUD_ORCHESTRATOR', 'AWS_OUTPOSTS');
                    alert('üåê Cross-cloud orchestration activated\nWorkload distribution optimized\nLatency-aware scheduling enabled');
                    break;

                case 'edge-federated':
                    // Trigger federated learning round
                    awsArchitecture.addCommunication('federated', 'FEDERATED_AGGREGATOR', 'EDGE_CLUSTER_1');
                    awsArchitecture.addCommunication('federated', 'FEDERATED_AGGREGATOR', 'EDGE_CLUSTER_2');
                    awsArchitecture.addCommunication('privacy-check', 'PRIVACY_COORDINATOR', 'EDGE_CLUSTER_1');
                    alert('üîê Federated learning round initiated\n1000+ edge devices participating\nDifferential privacy: Œµ=1.0');
                    break;

                default:
                    // Standard operation
                    awsArchitecture.addCommunication('data-transfer', 'S3_DATALAKE', 'SAGEMAKER_TRAINING');
                    alert('üéØ Standard training operation triggered\nData pipeline activated\nModel training commenced');
            }
        }
    }

    // Cost optimization suggestions
    function showCostOptimization() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;
            const suggestions = {
                'standard': [
                    'Use Spot instances for 70% cost reduction',
                    'Implement auto-scaling for EC2 instances',
                    'Use S3 Intelligent Tiering for storage',
                    'Consider Reserved Instances for predictable workloads'
                ],
                'eks-kubernetes': [
                    'Enable cluster autoscaling',
                    'Use Spot instances for worker nodes',
                    'Implement horizontal pod autoscaling',
                    'Optimize container resource requests'
                ],
                'batch-hpc': [
                    'Use Spot fleets for batch jobs',
                    'Implement job queues with priority',
                    'Use mixed instance types',
                    'Consider Savings Plans for sustained usage'
                ],
                'emr-spark': [
                    'Use Spot instances for core/task nodes',
                    'Enable auto-scaling for EMR clusters',
                    'Optimize Spark configurations',
                    'Use appropriate instance types for workload'
                ],
                'fargate-serverless': [
                    'Right-size container resources',
                    'Use scheduled scaling for predictable loads',
                    'Optimize container startup time',
                    'Consider Compute Savings Plans'
                ],
                'parallelcluster': [
                    'Use Spot instances for compute nodes',
                    'Implement intelligent job scheduling',
                    'Use mixed instance families',
                    'Optimize storage with FSx Lustre'
                ],
                'hybrid-multicloud': [
                    'Optimize data transfer costs',
                    'Use local processing where possible',
                    'Implement intelligent workload placement',
                    'Consider edge computing for latency-sensitive tasks'
                ],
                'edge-federated': [
                    'Minimize central aggregation frequency',
                    'Use compression for model updates',
                    'Implement efficient communication protocols',
                    'Optimize edge device utilization'
                ]
            };

            const templateSuggestions = suggestions[template] || suggestions['standard'];
            const suggestionText = templateSuggestions.join('\n‚Ä¢ ');

            alert(`üí∞ Cost Optimization Suggestions for ${template}:\n\n‚Ä¢ ${suggestionText}\n\nImplementing these could save 30-60% on compute costs.`);
        }
    }

    // Performance monitoring dashboard
    function showPerformanceMetrics() {
        if (awsArchitecture) {
            const template = awsArchitecture.currentTemplate;
            const metrics = awsArchitecture.awsMetrics;

            const templateSpecificMetrics = {
                'standard': `
üîç Standard Pipeline Metrics:
‚Ä¢ SageMaker Training: ${metrics.gpuUtilization}% GPU utilization
‚Ä¢ EC2 Instances: ${metrics.trainingInstances} active
‚Ä¢ Model Parameters: ${metrics.modelParams}
‚Ä¢ Training Loss: ${metrics.trainingLoss}
‚Ä¢ Data Throughput: ${metrics.throughput}
‚Ä¢ Network I/O: ${metrics.networkIO}
‚Ä¢ Reliability: ${metrics.reliabilityScore}%
‚Ä¢ Cost: $${metrics.costPerHour}/hour`,

                'eks-kubernetes': `
üö¢ Kubernetes Cluster Metrics:
‚Ä¢ Active Pods: ${metrics.trainingInstances * 8}
‚Ä¢ Node Utilization: ${metrics.gpuUtilization}%
‚Ä¢ Container Restart Rate: 0.02%
‚Ä¢ Service Mesh Latency: 2.5ms
‚Ä¢ Ingress Traffic: ${metrics.networkIO}
‚Ä¢ Cluster Efficiency: ${metrics.reliabilityScore}%
‚Ä¢ Monthly Cost: $${Math.round(metrics.costPerHour * 24 * 30)}`,

                'batch-hpc': `
üî¨ HPC Batch Metrics:
‚Ä¢ Running Jobs: ${metrics.trainingInstances * 125}
‚Ä¢ Queue Wait Time: 45 seconds
‚Ä¢ Job Success Rate: ${metrics.reliabilityScore}%
‚Ä¢ Compute Efficiency: ${metrics.gpuUtilization}%
‚Ä¢ Storage I/O: ${metrics.networkIO}
‚Ä¢ Parallel Efficiency: 94.2%
‚Ä¢ Cost per Job: $${(metrics.costPerHour / 100).toFixed(2)}`,

                'edge-federated': `
üåê Federated Learning Metrics:
‚Ä¢ Connected Devices: ${metrics.trainingInstances * 20}
‚Ä¢ Round Completion: 98.5%
‚Ä¢ Privacy Budget Used: 15%
‚Ä¢ Model Accuracy: 94.2%
‚Ä¢ Communication Overhead: 12%
‚Ä¢ Device Participation: ${metrics.reliabilityScore}%
‚Ä¢ Privacy Preserved: 100%`
            };

            const displayMetrics = templateSpecificMetrics[template] || templateSpecificMetrics['standard'];
            alert(displayMetrics);
        }
    }

    // Add these as additional control buttons (you can integrate into the UI)
    function addAdvancedControls() {
        // This function could be called to add template-specific controls
        // Implementation would depend on how you want to integrate these features
        console.log('Advanced controls for template:', awsArchitecture?.currentTemplate);
    }

    // Add new global functions for panel management
    function resetAllPanels() {
        if (panelManager) {
            panelManager.resetAllPanels();
        }
    }

    function minimizeAllPanels() {
        if (panelManager) {
            panelManager.minimizeAllPanels();
        }
    }

    function showAllPanels() {
        if (panelManager) {
            panelManager.showAllPanels();
        }
    }

    // Additional utility functions for panel management

    let panelsLocked = false;

    function togglePanelLock() {
        panelsLocked = !panelsLocked;

        if (panelManager) {
            panelManager.panels.forEach(({ element }) => {
                const dragHandle = element.querySelector('.drag-handle');
                if (dragHandle) {
                    if (panelsLocked) {
                        dragHandle.style.cursor = 'default';
                        dragHandle.style.opacity = '0.6';
                        element.style.pointerEvents = 'none';
                    } else {
                        dragHandle.style.cursor = 'move';
                        dragHandle.style.opacity = '1';
                        element.style.pointerEvents = 'auto';
                    }
                }
            });
        }

        const lockButton = event.target;
        lockButton.textContent = panelsLocked ? 'üîì Unlock Panels' : 'üîí Lock Panels';
        lockButton.classList.toggle('danger', panelsLocked);

        console.log(`üîí Panels ${panelsLocked ? 'locked' : 'unlocked'}`);
        alert(`üîí All panels are now ${panelsLocked ? 'LOCKED' : 'UNLOCKED'}`);
    }

    function saveLayout() {
        if (!panelManager) {
            alert('‚ùå Panel manager not initialized');
            return;
        }

        const layout = {};

        panelManager.panels.forEach(({ element, config }) => {
            const rect = element.getBoundingClientRect();
            layout[config.id] = {
                left: element.style.left || rect.left + 'px',
                top: element.style.top || rect.top + 'px',
                display: element.style.display || 'block',
                minimized: element.dataset.minimized === 'true',
                width: element.style.width || rect.width + 'px',
                height: element.style.height || rect.height + 'px'
            };
        });

        // Save to localStorage
        localStorage.setItem('awsArchitectureLayout', JSON.stringify(layout));

        console.log('üíæ Layout saved:', layout);
        alert('üíæ Panel layout saved successfully!');
    }

    function loadLayout() {
        if (!panelManager) {
            alert('‚ùå Panel manager not initialized');
            return;
        }

        const savedLayout = localStorage.getItem('awsArchitectureLayout');

        if (!savedLayout) {
            alert('‚ùå No saved layout found');
            return;
        }

        try {
            const layout = JSON.parse(savedLayout);

            panelManager.panels.forEach(({ element, config }) => {
                const panelLayout = layout[config.id];
                if (panelLayout) {
                    // Apply position
                    element.style.position = 'absolute';
                    element.style.left = panelLayout.left;
                    element.style.top = panelLayout.top;
                    element.style.display = panelLayout.display;

                    // Apply minimization state
                    if (panelLayout.minimized && element.dataset.minimized !== 'true') {
                        panelManager.toggleMinimize(element);
                    } else if (!panelLayout.minimized && element.dataset.minimized === 'true') {
                        panelManager.toggleMinimize(element);
                    }

                    // Apply dimensions if needed
                    if (panelLayout.width && panelLayout.width !== 'auto') {
                        element.style.width = panelLayout.width;
                    }
                    if (panelLayout.height && panelLayout.height !== 'auto') {
                        element.style.height = panelLayout.height;
                    }
                }
            });

            console.log('üìÅ Layout loaded:', layout);
            alert('üìÅ Panel layout loaded successfully!');

        } catch (error) {
            console.error('‚ùå Failed to load layout:', error);
            alert('‚ùå Failed to load saved layout');
        }
    }

    // Auto-save layout every 30 seconds when panels are moved
    let autoSaveTimeout;

    function scheduleAutoSave() {
        clearTimeout(autoSaveTimeout);
        autoSaveTimeout = setTimeout(() => {
            if (panelManager && !panelsLocked) {
                saveLayout();
                console.log('üîÑ Auto-saved panel layout');
            }
        }, 30000); // 30 seconds
    }

    // Enhanced drag end to trigger auto-save
    if (panelManager) {
        const originalEndDrag = panelManager.endDrag.bind(panelManager);
        panelManager.endDrag = function(e) {
            originalEndDrag(e);
            scheduleAutoSave();
        };
    }

    // Keyboard shortcuts for panel management
    document.addEventListener('keydown', (e) => {
        // Only work when not typing in inputs
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

        // Ctrl/Cmd + specific keys
        if (e.ctrlKey || e.metaKey) {
            switch(e.key.toLowerCase()) {
                case 'r':
                    e.preventDefault();
                    resetAllPanels();
                    break;
                case 'm':
                    e.preventDefault();
                    minimizeAllPanels();
                    break;
                case 's':
                    e.preventDefault();
                    saveLayout();
                    break;
                case 'l':
                    e.preventDefault();
                    togglePanelLock();
                    break;
            }
        }
    });

    // Show keyboard shortcuts help
    function showKeyboardShortcuts() {
        const shortcuts = `
üéõÔ∏è Panel Management Keyboard Shortcuts:

‚Ä¢ Ctrl/Cmd + R: Reset all panels
‚Ä¢ Ctrl/Cmd + M: Minimize all panels
‚Ä¢ Ctrl/Cmd + S: Save current layout
‚Ä¢ Ctrl/Cmd + L: Lock/unlock panels

üñ±Ô∏è Mouse Actions:
‚Ä¢ Click & Drag: Move panels
‚Ä¢ Double-click header: Minimize/restore panel
‚Ä¢ Right-click header: Context menu
‚Ä¢ Grid snapping: Automatic when dragging

üéØ Panel Features:
‚Ä¢ All panels remember their positions
‚Ä¢ Auto-save every 30 seconds after moving
‚Ä¢ Constrained to viewport boundaries
‚Ä¢ Visual feedback during dragging
    `;

        alert(shortcuts);
    }

    // Add the keyboard shortcuts button to your controls
    function addKeyboardShortcutsButton() {
        const systemControls = document.querySelector('.control-section:last-child .control-group:last-child');
        if (systemControls) {
            const shortcutsBtn = document.createElement('button');
            shortcutsBtn.textContent = '‚å®Ô∏è Shortcuts';
            shortcutsBtn.className = 'secondary';
            shortcutsBtn.onclick = showKeyboardShortcuts;
            systemControls.appendChild(shortcutsBtn);
        }
    }

    // Initialize keyboard shortcuts button when DOM is ready
    document.addEventListener('DOMContentLoaded', addKeyboardShortcutsButton);

    // Export functions for global access
    window.changeDeploymentTemplate = changeDeploymentTemplate;
    window.triggerTemplateSpecificOperation = triggerTemplateSpecificOperation;
    window.showCostOptimization = showCostOptimization;
    window.showPerformanceMetrics = showPerformanceMetrics;
    window.panelManager = panelManager;


</script>
</body>
</html>

